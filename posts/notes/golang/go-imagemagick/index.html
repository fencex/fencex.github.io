<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Go&#43;ImageMagick使用svg&#43;png绘制复杂图片"><meta property="og:title" content="Go&#43;ImageMagick使用svg&#43;png绘制复杂图片" />
<meta property="og:description" content="Go&#43;ImageMagick使用svg&#43;png绘制复杂图片" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://keli.tech/posts/notes/golang/go-imagemagick/" />
<meta property="og:image" content="https://keli.tech/image/roodblauw.png"/>
<meta property="article:published_time" content="2018-06-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-06-01T00:00:00+00:00" /><meta property="og:site_name" content="Fnece X 的技术博客" />
<title>Go&#43;ImageMagick使用svg&#43;png绘制复杂图片 | FenceX的技术博客</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.4cd45257a1c46b5e355d8e57e7d2e12ed2c376d6c4f1e3e8cf45b681334d0bc2.css" integrity="sha256-TNRSV6HEa141XY5X59LhLtLDdtbE8ePoz0W2gTNNC8I=">


<script defer src="/en.search.min.eb0e5807d82e2e4b40836204fd7516dbc2adf2b32bd4ff85184ab008db92cca5.js" integrity="sha256-6w5YB9guLktAg2IE/XUW28Kt8rMr1P&#43;FGEqwCNuSzKU="></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-44019270-5', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
  <link rel=stylesheet href="/js/audiojs/custom.css" >
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/image/logo.png" alt="Logo" /><span>FenceX的技术博客</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>









  <h2 id="提示本博客支持朗读audio-srcspeechmp3-preloadnone-speechnone">提示:本博客支持朗读<audio src="/speech.mp3" preload="none" speech="none"></h2>
<hr>
<ul>
<li><strong>组件</strong>
<ul>
<li><a href="/posts/redis/">Redis</a></li>
<li><a href="/posts/mysql/">Mysql</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>框架使用</strong>
<ul>
<li><a href="/posts/yii2/">Yii framework2</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>WEB安全</strong>
<ul>
<li><a href="/posts/csp/">CSP内容安全策略</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>工具</strong>
<ul>
<li><a href="/posts/tools/git/">Git</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>解决方案</strong>
<ul>
<li><a href="/posts/solution/golang/">Golang</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>备忘</strong>
<ul>
<li><a href="/posts/cheatsheet/scala/">Scala</a></li>
<li><a href="/posts/cheatsheet/data-structure/">数据结构</a></li>
<li><a href="/posts/cheatsheet/golang/">Golang</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>读书札记</strong>
<ul>
<li><a href="/posts/solution/golang/">大数据项目管理-从规划到实现</a></li>
<li><a href="/posts/solution/golang/">薛兆丰经济学讲义</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><strong>博客工具 &ndash; 介绍本博客涉及工具</strong>
<ul>
<li><a href="/posts/tools/hugo/book/">Hugo-book主题的使用技巧</a></li>
<li><a href="/posts/tools/hugo/vc/">Hugo-项目和版本控制</a></li>
<li><a href="/posts/tools/hugo/hugo/">Hugo-基本技巧</a></li>
<li><a href="/posts/tools/hugo/hugo-audio/">Hugo-支持audio播放</a></li>
<li><a href="/posts/tools/hugo/hugo-speech/">Hugo-支持博客朗读</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p><a href="/posts/"><strong>随笔</strong></a></p>
</li>
<li>
<p><a href="/posts/about-me/"><strong>关于我</strong></a></p>
</li>
</ul>
<hr>








</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Go&#43;ImageMagick使用svg&#43;png绘制复杂图片</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#需求-audio-preloadnoneaudio">需求 <audio preload="none"></audio></a>
          <ul>
            <li></li>
            <li><a href="#先上最终最终效果">先上最终最终效果</a></li>
          </ul>
        </li>
        <li><a href="#步骤">步骤</a>
          <ul>
            <li><a href="#一go-绘制基本图形">一、go 绘制基本图形</a></li>
            <li><a href="#二imagemagick-convert把-svg-转化为-png-加阴影">二、imagemagick convert把 svg 转化为 png, 加阴影</a></li>
            <li><a href="#三处理阴影svg">三、处理阴影svg</a></li>
          </ul>
        </li>
        <li><a href="#附go代码">附go代码：</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      


<link rel=stylesheet href="" >


<article class="markdown">
  <h1>
    <a href="/posts/notes/golang/go-imagemagick/">Go&#43;ImageMagick使用svg&#43;png绘制复杂图片</a>
  </h1>
  

<div>

  <h5>2018-06-01</h5>



  
  <div>
    
        <a href="/categories/solution/">solution</a>
  </div>
  

  
  <div>
    
        <a href="/tags/golang/">golang</a>, 
        <a href="/tags/imagemagick/">imagemagick</a>
  </div>
  


</div>


  <p><h2 id="需求-audio-preloadnoneaudio">需求 <audio preload="none"></audio></h2>
<p>开发过程会有使用go绘制较为复杂图形的需求，比如这次，需要做一个类似拖拽图案验证码。
具体需求：</p>
<ol>
<li>4条边,凹凸平3个形状，随机组合，</li>
<li>随机位置上截图如上形状的图片，并且在原图有如上形状的阴影遮罩</li>
</ol>
<p>go自带<code>image/draw</code> package 不能绘制复杂的图形（或者说太复杂），经过尝试，可以使用go来绘制svg，再使用imagemagick来进行特效处理，最后再次使用go把图层融合在一起。</p>
<h5 id="涉及package">涉及package</h5>
<p><code>github.com/ajstarks/svgo</code>  #基本图形svg绘制<br>
<code>github.com/gographics/imagick</code> #特效处理（需安装imagemagick)</p>
<h3 id="先上最终最终效果">先上最终最终效果</h3>
<p><img src="/image/go/gm1.png" alt="origin.png"></p>
<p><img src="/image/go/gm2.png" alt="tile-final.png"></p>
<h2 id="步骤">步骤</h2>
<h3 id="一go-绘制基本图形">一、go 绘制基本图形</h3>
<p>使用 svgo 来绘制 path，生成 svg，代码贴在最后</p>
<h3 id="二imagemagick-convert把-svg-转化为-png-加阴影">二、imagemagick convert把 svg 转化为 png, 加阴影</h3>
<p>注：只展示 imagemagick convert，没有融合到 go 程序里</p>
<p><img src="/image/go/gm3.png" alt="tile.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ImageMagick convert 命令</span>
convert <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#ae81ff">\(</span> -background none MSVG:tile-cut.svg -background black -shadow 50x2+0+10 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -gravity North -background none -extent 200x200 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -compose over  <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#ae81ff">\(</span> -background none MSVG:tile-cut.svg -background white -shadow 120x6+0+0 -resize 95% <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      -gravity center -background none -extent 200x200 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#ae81ff">\)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -background none -gravity NorthEast -geometry +0+0 -composite <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#ae81ff">\)</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -compose over tile-line.svg -gravity center -geometry +0+0 -composite <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>tile.png
</code></pre></div><p>代码注释：</p>
<ol>
<li>MSVG 支持svg 作为输入源，需要 imagemagick 支持 rsvg， 比如mac：
<code>brew install imagemagick --with-librsvg </code></li>
<li><code>-background black -shadow 50x2+0+10</code> 前两个数字自己调着看，影响shadow的大小和透明度，后两个是x，y轴偏移，可+可-</li>
<li><code>-background none</code> 背景透明</li>
<li>compose 两个图层组合方式， over 表示 后者在前者之上，还有其他选项，详见官网手册</li>
<li><code>-gravity North -background none -extent 200x200</code> -extent 扩展图片尺寸，-gravity North 表示扩展的时候，原图处于什么位置，North 表示北，还有NorthEast 等，详见官网手册</li>
</ol>
<h3 id="三处理阴影svg">三、处理阴影svg</h3>
<p><img src="/image/go/gm4.png" alt="tile-shadow.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ImageMagick convert 命令</span>
convert -density <span style="color:#ae81ff">2400</span> -background transparent  MSVG:tile-shadow.svg <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-fill <span style="color:#e6db74">&#34;rgba(0,0,0,0.3)&#34;</span> -opaque black -resize 200x200 tile-shadow.png
</code></pre></div><p>代码注释：</p>
<ol>
<li>-opaque 删除图片中颜色，这里删除黑色，填充rgba(0,0,0,0.3), 否则不能转化透明度，这里用了一个trick</li>
<li>-density 2400 这里通过修改了分辨率来提高 svg 转化到 png 的细致程度，再强制 -resize 200x200</li>
</ol>
<p>完成这个小需求绕挺多弯路现总结如下：</p>
<ol>
<li>go 可以完成一些简单图形的绘制，比如shape/tile 中At方法其实是对每个点进行上色，这是 draw 包的实现</li>
<li>go 支持图层叠加，支持图层融合</li>
<li>绘制几何图形使用 svg path，很方便，go可以使用 svgo 包，但是不支持转化成png图片，也不能作为draw包的输入源</li>
<li>图片处理 使用 imagemagick, 我这里没有使用扩展把逻辑写到代码里，因为我可以把这些 tile png先生成，go直接叠加图层，降低运算，比如这次需求，4条边，3种形状(凹凸平),2个类型(外边阴影，阴影填充) ，3x3x3x3x2 = 162</li>
</ol>
<h2 id="附go代码">附go代码：</h2>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-go-image" id="tabs-go-image-0" checked="checked" />
  <label for="tabs-go-image-0">
    main.go
  </label>
  <div class="book-tabs-content markdown-inner">
    <p>main.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;image&#34;</span>
	<span style="color:#e6db74">&#34;log&#34;</span>
	<span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;image/jpeg&#34;</span>
	<span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;image/png&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;math/rand&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
	<span style="color:#e6db74">&#34;math&#34;</span>
	<span style="color:#e6db74">&#34;image/png&#34;</span>
	<span style="color:#e6db74">&#34;image/draw&#34;</span>
	<span style="color:#e6db74">&#34;captcha/shape&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

    <span style="color:#75715e">//保存svgs，
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">saveSvgs</span>()

	<span style="color:#a6e22e">cutWidth</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">200</span>
	<span style="color:#a6e22e">top</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">left</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
   
	<span style="color:#a6e22e">reader</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;images/14d4c647b216975cb298481f4e550ebc.jpg&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">m</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">reader</span>)
	<span style="color:#a6e22e">rgbImg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">YCbCr</span>)

	<span style="color:#a6e22e">reader2</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;tile.png&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">reader2</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">m2</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">reader2</span>)
	<span style="color:#a6e22e">rgbImg2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m2</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">NRGBA64</span>)

	<span style="color:#a6e22e">reader3</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;tile-shadow.png&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">reader3</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">m3</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">reader3</span>)
	<span style="color:#a6e22e">rgbImg3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m3</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">NRGBA64</span>)

	<span style="color:#a6e22e">randRect</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getRandomRectangle</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">cutWidth</span>, <span style="color:#a6e22e">cutWidth</span>)
	<span style="color:#a6e22e">tile</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shape</span>.<span style="color:#a6e22e">Tile</span>{<span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Pt</span>(<span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">0</span>), <span style="color:#a6e22e">cutWidth</span>, <span style="color:#a6e22e">top</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">left</span>, <span style="color:#66d9ef">false</span>}

    <span style="color:#75715e">// go draw 包处理代码，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 新建图片
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">originImage</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">NewRGBA</span>(<span style="color:#a6e22e">rgbImg</span>.<span style="color:#a6e22e">Bounds</span>())
    <span style="color:#75715e">// 使用draw原图
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Draw</span>(<span style="color:#a6e22e">originImage</span>, <span style="color:#a6e22e">rgbImg</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">rgbImg</span>, <span style="color:#a6e22e">rgbImg</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Min</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Src</span>)
	<span style="color:#75715e">// 把imagemagick处理好的阴影png 绘制到图片的随机位置 randRect 之上
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Draw</span>(<span style="color:#a6e22e">originImage</span>, <span style="color:#a6e22e">randRect</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">rgbImg3</span>, <span style="color:#a6e22e">rgbImg3</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Min</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Over</span>)

	<span style="color:#a6e22e">f2</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#e6db74">&#34;origin.png&#34;</span>)
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">f2</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">png</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">f2</span>, <span style="color:#a6e22e">originImage</span>)

	<span style="color:#a6e22e">cutImage4</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">NewRGBA</span>(<span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">cutWidth</span>, <span style="color:#a6e22e">cutWidth</span>))
	<span style="color:#75715e">// 在随机位置randRect 截取 tile 形状的截图
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">DrawMask</span>(<span style="color:#a6e22e">cutImage4</span>, <span style="color:#a6e22e">cutImage4</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">rgbImg</span>, <span style="color:#a6e22e">randRect</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Min</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tile</span>, <span style="color:#a6e22e">tile</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Min</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Src</span>)
    <span style="color:#75715e">// 在图片之上添加 imagemagick 处理好的 tile.png
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Draw</span>(<span style="color:#a6e22e">cutImage4</span>, <span style="color:#a6e22e">cutImage4</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">rgbImg2</span>, <span style="color:#a6e22e">rgbImg2</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Min</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Over</span>)
	<span style="color:#a6e22e">f5</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#e6db74">&#34;tile-final.png&#34;</span>)
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">f5</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">png</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">f5</span>, <span style="color:#a6e22e">cutImage4</span>)
}

<span style="color:#75715e">// 绘制svg
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">saveSvgs</span>(){
    <span style="color:#a6e22e">cutWidth</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">200</span>
	<span style="color:#a6e22e">top</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">left</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>

    <span style="color:#75715e">//保存 svg 文件
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">tileSvg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">shape</span>.<span style="color:#a6e22e">TileSvg</span>{<span style="color:#a6e22e">cutWidth</span>, <span style="color:#a6e22e">top</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">bottom</span>, <span style="color:#a6e22e">left</span>}
	<span style="color:#a6e22e">tileSvg</span>.<span style="color:#a6e22e">SaveSvg</span>(<span style="color:#e6db74">&#34;tile-cut.svg&#34;</span>, <span style="color:#e6db74">&#34;stroke-width:10;stroke:White;fill:none;&#34;</span>)
	<span style="color:#a6e22e">tileSvg</span>.<span style="color:#a6e22e">SaveSvg</span>(<span style="color:#e6db74">&#34;tile-line.svg&#34;</span>, <span style="color:#e6db74">&#34;stroke-width:2;stroke:White;fill:none;&#34;</span>)
	<span style="color:#a6e22e">tileSvg</span>.<span style="color:#a6e22e">SaveSvg</span>(<span style="color:#e6db74">&#34;tile-shadow.svg&#34;</span>, <span style="color:#e6db74">&#34;stroke-width:2;stroke:White;fill:black;fill-opacity:0.5&#34;</span>)
}

<span style="color:#75715e">// 随机获取截图位置
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">getRandomRectangle</span>(<span style="color:#a6e22e">rectangle</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rectangle</span>, <span style="color:#a6e22e">subWidth</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">subHeight</span> <span style="color:#66d9ef">int</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rectangle</span>) {
	<span style="color:#a6e22e">bounds</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rectangle</span>.<span style="color:#a6e22e">Bounds</span>()
	<span style="color:#a6e22e">width</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bounds</span>.<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">X</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">bounds</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span>
	<span style="color:#a6e22e">height</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bounds</span>.<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">Y</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">bounds</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span>

	<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>())
	<span style="color:#a6e22e">maxPosX</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Ceil</span>(float64(<span style="color:#a6e22e">width</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Ceil</span>(float64(<span style="color:#a6e22e">subWidth</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">1.3</span>)
	<span style="color:#a6e22e">maxPosY</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Ceil</span>(float64(<span style="color:#a6e22e">height</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.7</span>) <span style="color:#f92672">-</span> <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Ceil</span>(float64(<span style="color:#a6e22e">subHeight</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">1.3</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">maxPosX</span> &lt; <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">maxPosY</span> &lt; <span style="color:#ae81ff">0</span> {
		<span style="color:#75715e">//todo error
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">tmp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tmp</span>
	}
	<span style="color:#a6e22e">posX</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(int(<span style="color:#a6e22e">maxPosX</span>)) <span style="color:#f92672">+</span> int(<span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Ceil</span>(float64(<span style="color:#a6e22e">width</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.3</span>))
	<span style="color:#a6e22e">posY</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(int(<span style="color:#a6e22e">maxPosY</span>)) <span style="color:#f92672">+</span> int(<span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">Ceil</span>(float64(<span style="color:#a6e22e">height</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.3</span>))

	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">maxPosX</span>, <span style="color:#a6e22e">maxPosY</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">posX</span>, <span style="color:#a6e22e">posY</span>, <span style="color:#a6e22e">posX</span><span style="color:#f92672">+</span>int(<span style="color:#a6e22e">subWidth</span>), <span style="color:#a6e22e">posY</span><span style="color:#f92672">+</span>int(<span style="color:#a6e22e">subHeight</span>))

	<span style="color:#a6e22e">retRectangle</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#a6e22e">posX</span>, <span style="color:#a6e22e">posY</span>, <span style="color:#a6e22e">posX</span><span style="color:#f92672">+</span>int(<span style="color:#a6e22e">subWidth</span>), <span style="color:#a6e22e">posY</span><span style="color:#f92672">+</span>int(<span style="color:#a6e22e">subHeight</span>), )

	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">retRectangle</span>
}
</code></pre></div>
  </div>

  <input type="radio" class="hidden" name="tabs-go-image" id="tabs-go-image-1"  />
  <label for="tabs-go-image-1">
    shape/tilesvg.go
  </label>
  <div class="book-tabs-content markdown-inner">
    <p>绘制svg图形</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">shape</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/ajstarks/svgo&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TileSvg</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Width</span> <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">T</span>     <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">R</span>     <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">B</span>     <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">L</span>     <span style="color:#66d9ef">int</span>
}

<span style="color:#75715e">/**
</span><span style="color:#75715e">shape svg path
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">TileSvg</span>) <span style="color:#a6e22e">SaveSvg</span>(<span style="color:#a6e22e">filename</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">stroke</span> <span style="color:#66d9ef">string</span>) {
	<span style="color:#a6e22e">width</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Width</span>
	<span style="color:#a6e22e">height</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Width</span>
	<span style="color:#a6e22e">f5</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#a6e22e">filename</span>)
	<span style="color:#a6e22e">canvas</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">svg</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">f5</span>)
	<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">Start</span>(<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span>)

	<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">stroke</span>) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">stroke</span> = <span style="color:#e6db74">&#34;stroke-width:10;stroke:green;fill:red;&#34;</span>
	}
	<span style="color:#a6e22e">path</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;M%d,%d h%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">T</span> &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;A%d,%d 0 0,1 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">T</span> &lt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;A%d,%d 0 1,0 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;h+%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	}
	<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;h%d v%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">R</span> &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;A%d,%d 0 0,1 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">R</span> &lt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;A%d,%d 0 1,0 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">3</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;v+%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	}
	<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;v%d h-%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">B</span> &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;A%d,%d 0 0,1 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">B</span> &lt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;A%d,%d 0 1,0 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;h-%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	}
	<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;h-%d v-%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">L</span> &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34; A%d,%d 0 0,1 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">L</span> &lt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34; A%d,%d 0 1,0 %d,%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;v-%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	}
	<span style="color:#a6e22e">path</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;v-%d &#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>)
	<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">Path</span>(<span style="color:#a6e22e">path</span>, <span style="color:#a6e22e">stroke</span>)

	<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">End</span>()
}

</code></pre></div>
  </div>

  <input type="radio" class="hidden" name="tabs-go-image" id="tabs-go-image-2"  />
  <label for="tabs-go-image-2">
    shape/tile.go
  </label>
  <div class="book-tabs-content markdown-inner">
    <p>shape/tile.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">shape</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;image&#34;</span>
	<span style="color:#e6db74">&#34;image/color&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Tile</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Min</span>    <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Point</span>
	<span style="color:#a6e22e">Width</span>  <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">T</span>      <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">R</span>      <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">B</span>      <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">L</span>      <span style="color:#66d9ef">int</span>
	<span style="color:#a6e22e">Revert</span> <span style="color:#66d9ef">bool</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Tile</span>) <span style="color:#a6e22e">ColorModel</span>() <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Model</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">AlphaModel</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Tile</span>) <span style="color:#a6e22e">Bounds</span>() <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rectangle</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span>)
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Tile</span>) <span style="color:#a6e22e">At</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>) <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Color</span> {

	<span style="color:#a6e22e">colorAt</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Alpha</span>{<span style="color:#ae81ff">220</span>}
	<span style="color:#a6e22e">colorWithin</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Alpha</span>{<span style="color:#ae81ff">220</span>}
	<span style="color:#a6e22e">colorWithout</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Alpha</span>{<span style="color:#ae81ff">0</span>}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Revert</span> {
		<span style="color:#a6e22e">colorWithin</span> = <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Alpha</span>{<span style="color:#ae81ff">0</span>}
		<span style="color:#a6e22e">colorWithout</span> = <span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">Alpha</span>{<span style="color:#ae81ff">220</span>}
	}

	<span style="color:#a6e22e">margin</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">5</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">x</span> &gt; (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">x</span> &lt; (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">y</span> &gt; (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">y</span> &lt; (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">Y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5</span>) {
		<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithin</span>
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithout</span>
	}

	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>
	<span style="color:#75715e">//todo 优化算法
</span><span style="color:#75715e"></span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">T</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">roundSpot</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Pt</span>((<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span><span style="color:#f92672">+</span><span style="color:#a6e22e">margin</span>)
		<span style="color:#a6e22e">xx</span>, <span style="color:#a6e22e">yy</span>, <span style="color:#a6e22e">rr</span> <span style="color:#f92672">:=</span> float64(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">X</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">Y</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">r</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">xx</span><span style="color:#f92672">*</span><span style="color:#a6e22e">xx</span><span style="color:#f92672">+</span><span style="color:#a6e22e">yy</span><span style="color:#f92672">*</span><span style="color:#a6e22e">yy</span> &lt; <span style="color:#a6e22e">rr</span><span style="color:#f92672">*</span><span style="color:#a6e22e">rr</span> {
			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">T</span> &gt; <span style="color:#ae81ff">0</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithin</span>
			} <span style="color:#66d9ef">else</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithout</span>
			}
		}
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">R</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">roundSpot</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Pt</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">-</span><span style="color:#a6e22e">margin</span>, (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">Y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span>)
		<span style="color:#a6e22e">xx</span>, <span style="color:#a6e22e">yy</span>, <span style="color:#a6e22e">rr</span> <span style="color:#f92672">:=</span> float64(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">X</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">Y</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">r</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">xx</span><span style="color:#f92672">*</span><span style="color:#a6e22e">xx</span><span style="color:#f92672">+</span><span style="color:#a6e22e">yy</span><span style="color:#f92672">*</span><span style="color:#a6e22e">yy</span> &lt; <span style="color:#a6e22e">rr</span><span style="color:#f92672">*</span><span style="color:#a6e22e">rr</span> {
			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">R</span> &gt; <span style="color:#ae81ff">0</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithin</span>
			} <span style="color:#66d9ef">else</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithout</span>
			}
		}
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">B</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">roundSpot</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Pt</span>((<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span>, (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">Y</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">margin</span>))
		<span style="color:#a6e22e">xx</span>, <span style="color:#a6e22e">yy</span>, <span style="color:#a6e22e">rr</span> <span style="color:#f92672">:=</span> float64(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">X</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">Y</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">r</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">xx</span><span style="color:#f92672">*</span><span style="color:#a6e22e">xx</span><span style="color:#f92672">+</span><span style="color:#a6e22e">yy</span><span style="color:#f92672">*</span><span style="color:#a6e22e">yy</span> &lt; <span style="color:#a6e22e">rr</span><span style="color:#f92672">*</span><span style="color:#a6e22e">rr</span> {
			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">B</span> &gt; <span style="color:#ae81ff">0</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithin</span>
			} <span style="color:#66d9ef">else</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithout</span>
			}
		}
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">L</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">roundSpot</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Pt</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">X</span><span style="color:#f92672">+</span><span style="color:#a6e22e">margin</span>, (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Max</span>.<span style="color:#a6e22e">Y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Min</span>.<span style="color:#a6e22e">Y</span>)
		<span style="color:#a6e22e">xx</span>, <span style="color:#a6e22e">yy</span>, <span style="color:#a6e22e">rr</span> <span style="color:#f92672">:=</span> float64(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">X</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">roundSpot</span>.<span style="color:#a6e22e">Y</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>, float64(<span style="color:#a6e22e">r</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.5</span>
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">xx</span><span style="color:#f92672">*</span><span style="color:#a6e22e">xx</span><span style="color:#f92672">+</span><span style="color:#a6e22e">yy</span><span style="color:#f92672">*</span><span style="color:#a6e22e">yy</span> &lt; <span style="color:#a6e22e">rr</span><span style="color:#f92672">*</span><span style="color:#a6e22e">rr</span> {
			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">L</span> &gt; <span style="color:#ae81ff">0</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithin</span>
			} <span style="color:#66d9ef">else</span> {
				<span style="color:#a6e22e">colorAt</span> = <span style="color:#a6e22e">colorWithout</span>
			}
		}
	}

	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">colorAt</span>
}

</code></pre></div>
  </div>

</div></p>
</article>



<script src=""></script>


 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "fence-x" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#需求-audio-preloadnoneaudio">需求 <audio preload="none"></audio></a>
          <ul>
            <li></li>
            <li><a href="#先上最终最终效果">先上最终最终效果</a></li>
          </ul>
        </li>
        <li><a href="#步骤">步骤</a>
          <ul>
            <li><a href="#一go-绘制基本图形">一、go 绘制基本图形</a></li>
            <li><a href="#二imagemagick-convert把-svg-转化为-png-加阴影">二、imagemagick convert把 svg 转化为 png, 加阴影</a></li>
            <li><a href="#三处理阴影svg">三、处理阴影svg</a></li>
          </ul>
        </li>
        <li><a href="#附go代码">附go代码：</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  

  <script src="/js/audiojs/audio.min.js"></script>
  <script src="/js/audiojs/custom.js"></script>
</body>

</html>












