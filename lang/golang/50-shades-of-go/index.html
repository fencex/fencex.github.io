<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="新手Gopher常犯的50个错误"><meta property="og:title" content="新手Gopher常犯的50个错误" />
<meta property="og:description" content="阿里云 Composer 全量镜像" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://keli.tech/lang/golang/50-shades-of-go/" />
<meta property="og:image" content="https://keli.tech/image/roodblauw.png"/>
<meta property="article:published_time" content="2020-12-22T12:12:02+00:00" />
<meta property="article:modified_time" content="2020-12-22T12:12:02+00:00" /><meta property="og:site_name" content="Fnece X 的技术博客" />
<title>新手Gopher常犯的50个错误 | FenceX的技术博客</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.e1f007deecfcca32c7dbea43241a13b4e0cd50b18f64b4b15863a2dbf6ff29cd.css" integrity="sha256-4fAH3uz8yjLH2&#43;pDJBoTtODNULGPZLSxWGOi2/b/Kc0=">


<script defer src="/en.search.min.98072e0d1c5236989f51cef40fdf8edc463d71f261a80805cb22fcbe118b1d1f.js" integrity="sha256-mAcuDRxSNpifUc70D9&#43;O3EY9cfJhqAgFyyL8vhGLHR8="></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-44019270-5', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
  <link rel=stylesheet href="/js/audiojs/custom.css" >
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/image/logo.png" alt="Logo" /><span>FenceX的技术博客</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>









  

  






  <ul>
  
    

  <li >
    
      

  <a href="/posts/" >
      博客
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/posts/tools/" >
      工具
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/posts/csp/" >
      内容安全策略
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/posts/mysql1/" >
      Spark
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/posts/yii2/" >
      yii2
  </a>


    

    






  </li>


      
    
      
        <li>

  <a href="/posts/about-me/" >
      关于我
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/database/" >
      数据库
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/database/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/database/mysql/" >
      Mysql
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/concurrency/" >
      高并发
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/ideas/" >
      想法💡
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/lang/" >
      编程语言
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/lang/php/" >
      PHP
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/lang/php/composer-config-alibaba/" >
      阿里云 Composer 全量镜像php
  </a>

</li>
      
    
      
        <li>

  <a href="/lang/php/function-unexpected/" >
      PHP的函数中意想不到的坑
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/lang/golang/" >
      Golang
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/lang/golang/50-shades-of-go/"  class="active">
      新手Gopher常犯的50个错误
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


  
  </ul>














</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>新手Gopher常犯的50个错误</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1开头大括号不能放在单独的行上">1.开头大括号不能放在单独的行上</a></li>
        <li><a href="#2未使用的变量">2.未使用的变量</a></li>
        <li><a href="#3未使用的导入">3.未使用的导入</a></li>
        <li><a href="#4简短的变量声明只能在函数内部使用">4.简短的变量声明只能在函数内部使用</a></li>
        <li><a href="#5使用短变量声明重新声明变量">5.使用短变量声明重新声明变量</a></li>
        <li><a href="#6不能使用短变量声明来设置字段值">6.不能使用短变量声明来设置字段值</a></li>
        <li><a href="#7可能出现的变量阴影">7.可能出现的“变量阴影”</a></li>
        <li><a href="#8不能使用nil来初始化没有显式类型的变量-var">8.不能使用“nil”来初始化没有显式类型的变量 var</a></li>
        <li><a href="#9using-nil-slices-and-maps">9.Using &ldquo;nil&rdquo; Slices and Maps</a></li>
        <li><a href="#map-capacity">Map Capacity</a></li>
        <li><a href="#strings-cant-be-nil">Strings Can&rsquo;t Be &ldquo;nil&rdquo;</a></li>
        <li><a href="#array-function-arguments">Array Function Arguments</a></li>
        <li><a href="#unexpected-values-in-slice-and-array-range-clauses">Unexpected Values in Slice and Array &ldquo;range&rdquo; Clauses</a></li>
        <li><a href="#slices-and-arrays-are-one-dimensional">Slices and Arrays Are One-Dimensional</a></li>
        <li><a href="#accessing-non-existing-map-keys">Accessing Non-Existing Map Keys</a></li>
        <li><a href="#strings-are-immutable">Strings Are Immutable</a></li>
        <li><a href="#conversions-between-strings-and-byte-slices">Conversions Between Strings and Byte Slices</a></li>
        <li><a href="#strings-and-index-operator">Strings and Index Operator</a></li>
        <li><a href="#strings-are-not-always-utf8-text">Strings Are Not Always UTF8 Text</a></li>
        <li><a href="#string-length">String Length</a></li>
        <li><a href="#missing-comma-in-multi-line-slice-array-and-map-literals">Missing Comma In Multi-Line Slice, Array, and Map Literals</a></li>
        <li><a href="#logfatal-and-logpanic-do-more-than-log">log.Fatal and log.Panic Do More Than Log</a></li>
        <li><a href="#built-in-data-structure-operations-are-not-synchronized">Built-in Data Structure Operations Are Not Synchronized</a></li>
        <li><a href="#iteration-values-for-strings-in-range-clauses">Iteration Values For Strings in &ldquo;range&rdquo; Clauses</a></li>
        <li><a href="#iterating-through-a-map-using-a-for-range-clause">Iterating Through a Map Using a &ldquo;for range&rdquo; Clause</a></li>
        <li><a href="#fallthrough-behavior-in-switch-statements">Fallthrough Behavior in &ldquo;switch&rdquo; Statements</a></li>
        <li><a href="#increments-and-decrements">Increments and Decrements</a></li>
        <li><a href="#bitwise-not-operator">Bitwise NOT Operator</a></li>
        <li><a href="#operator-precedence-differences">Operator Precedence Differences</a></li>
        <li><a href="#unexported-structure-fields-are-not-encoded">Unexported Structure Fields Are Not Encoded</a></li>
        <li><a href="#app-exits-with-active-goroutines">App Exits With Active Goroutines</a></li>
        <li><a href="#sending-to-an-unbuffered-channel-returns-as-soon-as-the-target-receiver-is-ready">Sending to an Unbuffered Channel Returns As Soon As the Target Receiver Is Ready</a></li>
        <li><a href="#sending-to-an-closed-channel-causes-a-panic">Sending to an Closed Channel Causes a Panic</a></li>
        <li><a href="#using-nil-channels">Using &ldquo;nil&rdquo; Channels</a></li>
        <li><a href="#methods-with-value-receivers-cant-change-the-original-value">Methods with Value Receivers Can&rsquo;t Change the Original Value</a></li>
        <li><a href="#closing-http-response-body">Closing HTTP Response Body</a></li>
        <li><a href="#closing-http-connections">Closing HTTP Connections</a></li>
        <li><a href="#json-encoder-adds-a-newline-character">JSON Encoder Adds a Newline Character</a></li>
        <li><a href="#json-package-escapes-special-html-characters-in-keys-and-string-values">JSON Package Escapes Special HTML Characters in Keys and String Values</a></li>
        <li><a href="#unmarshalling-json-numbers-into-interface-values">Unmarshalling JSON Numbers into Interface Values</a></li>
        <li><a href="#json-string-values-will-not-be-ok-with-hex-or-other-non-utf8-escape-sequences">JSON String Values Will Not Be Ok with Hex or Other non-UTF8 Escape Sequences</a></li>
        <li><a href="#comparing-structs-arrays-slices-and-maps">Comparing Structs, Arrays, Slices, and Maps</a></li>
        <li><a href="#recovering-from-a-panic">Recovering From a Panic</a></li>
        <li><a href="#updating-and-referencing-item-values-in-slice-array-and-map-range-clauses">Updating and Referencing Item Values in Slice, Array, and Map &ldquo;range&rdquo; Clauses</a></li>
        <li><a href="#hidden-data-in-slices">&ldquo;Hidden&rdquo; Data in Slices</a></li>
        <li><a href="#slice-data-corruption">Slice Data &ldquo;Corruption&rdquo;</a></li>
        <li><a href="#stale-slices">&ldquo;Stale&rdquo; Slices</a></li>
        <li><a href="#type-declarations-and-methods">Type Declarations and Methods</a></li>
        <li><a href="#breaking-out-of-for-switch-and-for-select-code-blocks">Breaking Out of &ldquo;for switch&rdquo; and &ldquo;for select&rdquo; Code Blocks</a></li>
        <li><a href="#iteration-variables-and-closures-in-for-statements">Iteration Variables and Closures in &ldquo;for&rdquo; Statements</a></li>
        <li><a href="#deferred-function-call-argument-evaluation">Deferred Function Call Argument Evaluation</a></li>
        <li><a href="#deferred-function-call-execution">Deferred Function Call Execution</a></li>
        <li><a href="#failed-type-assertions">Failed Type Assertions</a></li>
        <li><a href="#blocked-goroutines-and-resource-leaks">Blocked Goroutines and Resource Leaks</a></li>
        <li><a href="#same-address-for-different-zero-sized-variables">Same Address for Different Zero-sized Variables</a></li>
        <li><a href="#the-first-use-of-iota-doesnt-always-start-with-zero">The First Use of iota Doesn&rsquo;t Always Start with Zero</a></li>
        <li><a href="#using-pointer-receiver-methods-on-value-instances">Using Pointer Receiver Methods On Value Instances</a></li>
        <li><a href="#updating-map-value-fields">Updating Map Value Fields</a></li>
        <li><a href="#nil-interfaces-and-nil-interfaces-values">&ldquo;nil&rdquo; Interfaces and &ldquo;nil&rdquo; Interfaces Values</a></li>
        <li><a href="#stack-and-heap-variables">Stack and Heap Variables</a></li>
        <li><a href="#gomaxprocs-concurrency-and-parallelism">GOMAXPROCS, Concurrency, and Parallelism</a></li>
        <li><a href="#read-and-write-operation-reordering">Read and Write Operation Reordering</a></li>
        <li><a href="#preemptive-scheduling">Preemptive Scheduling</a></li>
        <li><a href="#import-c-and-multiline-import-blocks">Import C and Multiline Import Blocks</a></li>
        <li><a href="#no-blank-lines-between-import-c-and-cgo-comments">No blank lines Between Import C and Cgo Comments</a></li>
        <li><a href="#cant-call-c-functions-with-variable-arguments">Can&rsquo;t Call C Functions with Variable Arguments</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      


<link rel=stylesheet href="" >


<article class="markdown">
  <h1>
    <a href="/lang/golang/50-shades-of-go/">新手Gopher常犯的50个错误</a>
  </h1>
  <hr/>


<div>

  <h5>2020-12-22</h5>



  
  <div>
    
        <a href="/categories/golang/">golang</a>
  </div>
  

  


</div>


  <p><h2 id="1开头大括号不能放在单独的行上">1.开头大括号不能放在单独的行上</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>其实，和C一样，Go的正式的语法使用分号来终止语句。和C不同的是，这些分号由词法分析器在扫描源代码过程中使用简单的规则自动插入分号，因此输入源代码多数时候就不需要分号了。
无论任何时候，你都不应该将一个控制结构（(if、for、switch或select）的左大括号放在下一行。如果这样做，将会在大括号的前方插入一个分号，否则编译报错。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-semicolon" id="tabs-semicolon-0" checked="checked" />
  <label for="tabs-semicolon-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>  
<span style="color:#111">{</span> <span style="color:#75715e">//error, 开头大括号不能独立一行
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;hello there!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox826898458/main.go:6: syntax error: unexpected semicolon or newline before {</p>
</blockquote>

  </div>

  <input type="radio" class="hidden" name="tabs-semicolon" id="tabs-semicolon-1"  />
  <label for="tabs-semicolon-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;works!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
  </div>

</div>

<h2 id="2未使用的变量">2.未使用的变量</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>如果您有未使用的变量，您的代码将无法编译。但是也有例外: 1. 有未使用的全局变量，2. 有未使用的函数参数。</p>
<p>如果将新值分配给未使用的变量，则代码仍将无法编译</p>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-unusevar" id="tabs-unusevar-0" checked="checked" />
  <label for="tabs-unusevar-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#00a8c8">var</span> <span style="color:#75af00">gvar</span> <span style="color:#00a8c8">int</span> <span style="color:#75715e">//not an error
</span><span style="color:#75715e"></span><span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">one</span> <span style="color:#00a8c8">int</span>   <span style="color:#75715e">//error, unused variable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">two</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>      <span style="color:#75715e">//error, unused variable
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">var</span> <span style="color:#75af00">three</span> <span style="color:#00a8c8">int</span> <span style="color:#75715e">//error, even though it&#39;s assigned 3 on the next line
</span><span style="color:#75715e"></span>    <span style="color:#75af00">three</span> <span style="color:#111">=</span> <span style="color:#ae81ff">3</span>

    <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">unused</span> <span style="color:#00a8c8">string</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Unused arg. No compile error&#34;</span><span style="color:#111">)</span>
    <span style="color:#111">}(</span><span style="color:#d88200">&#34;what?&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox473116179/main.go:6: one declared and not used /tmp/sandbox473116179/main.go:7: two declared and not used /tmp/sandbox473116179/main.go:8: three declared and not used</p>
</blockquote>

  </div>

  <input type="radio" class="hidden" name="tabs-unusevar" id="tabs-unusevar-1"  />
  <label for="tabs-unusevar-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">one</span> <span style="color:#00a8c8">int</span>
    <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">one</span>

    <span style="color:#75af00">two</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span> 
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">two</span><span style="color:#111">)</span>

    <span style="color:#00a8c8">var</span> <span style="color:#75af00">three</span> <span style="color:#00a8c8">int</span> 
    <span style="color:#75af00">three</span> <span style="color:#111">=</span> <span style="color:#ae81ff">3</span>
    <span style="color:#75af00">one</span> <span style="color:#111">=</span> <span style="color:#75af00">three</span>

    <span style="color:#00a8c8">var</span> <span style="color:#75af00">four</span> <span style="color:#00a8c8">int</span>
    <span style="color:#75af00">four</span> <span style="color:#111">=</span> <span style="color:#75af00">four</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>另一种选择是注释掉或删除未使用的变量:-)</p>

  </div>

</div>

<h2 id="3未使用的导入">3.未使用的导入</h2>
<p>Unused Import</p>
<ul>
<li>level: beginner</li>
</ul>
<p>如果在不使用任何导出函数，接口，结构或变量的情况下导入软件包，则代码将无法编译。<br>
如果确实需要导入的软件包，则可以使用空白标识符_作为其软件包名称，以避免此编译失败。</p>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-unuseimport" id="tabs-unuseimport-0" checked="checked" />
  <label for="tabs-unuseimport-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;log&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox627475386/main.go:4: imported and not used: &ldquo;fmt&rdquo; /tmp/sandbox627475386/main.go:5: imported and not used: &ldquo;log&rdquo; /tmp/sandbox627475386/main.go:6: imported and not used: &ldquo;time&rdquo;</p>
</blockquote>

  </div>

  <input type="radio" class="hidden" name="tabs-unuseimport" id="tabs-unuseimport-1"  />
  <label for="tabs-unuseimport-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#75af00">_</span> <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;log&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">var</span> <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">log</span><span style="color:#111">.</span><span style="color:#75af00">Println</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Now</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>另一个选择是删除或注释掉未使用的导入：-) goimports工具也可以帮助您。</p>

  </div>

</div>

<h2 id="4简短的变量声明只能在函数内部使用">4.简短的变量声明只能在函数内部使用</h2>
<p>Short Variable Declarations Can Be Used Only Inside Functions</p>
<ul>
<li>level: beginner</li>
</ul>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-shortvar" id="tabs-shortvar-0" checked="checked" />
  <label for="tabs-shortvar-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#75af00">myvar</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox265716165/main.go:3: non-declaration statement outside function body</p>
</blockquote>

  </div>

  <input type="radio" class="hidden" name="tabs-shortvar" id="tabs-shortvar-1"  />
  <label for="tabs-shortvar-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">var</span> <span style="color:#75af00">myvar</span> <span style="color:#111">=</span> <span style="color:#ae81ff">1</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
  </div>

</div>

<h2 id="5使用短变量声明重新声明变量">5.使用短变量声明重新声明变量</h2>
<p>Redeclaring Variables Using Short Variable Declarations</p>
<ul>
<li>level: beginner</li>
</ul>
<p>您无法在独立的语句中重新声明变量，但是在多变量声明中允许使用该变量，其中至少还声明了一个新变量。<br>
重新声明的变量必须位于同一块中，否则最终将得到阴影变量。</p>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-shortvarreassign" id="tabs-shortvarreassign-0" checked="checked" />
  <label for="tabs-shortvarreassign-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">one</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#75af00">one</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox706333626/main.go:5: no new variables on left side of :=</p>
</blockquote>

  </div>

  <input type="radio" class="hidden" name="tabs-shortvarreassign" id="tabs-shortvarreassign-1"  />
  <label for="tabs-shortvarreassign-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">one</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#75af00">one</span><span style="color:#111">,</span> <span style="color:#75af00">two</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span>

    <span style="color:#75af00">one</span><span style="color:#111">,</span><span style="color:#75af00">two</span> <span style="color:#111">=</span> <span style="color:#75af00">two</span><span style="color:#111">,</span><span style="color:#75af00">one</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
  </div>

</div>

<h2 id="6不能使用短变量声明来设置字段值">6.不能使用短变量声明来设置字段值</h2>
<p>Can&rsquo;t Use Short Variable Declarations to Set Field Values</p>
<ul>
<li>level: beginner</li>
</ul>




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-shortreassignvar" id="tabs-shortreassignvar-0" checked="checked" />
  <label for="tabs-shortreassignvar-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">info</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
  <span style="color:#75af00">result</span> <span style="color:#00a8c8">int</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">work</span><span style="color:#111">()</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#00a8c8">error</span><span style="color:#111">)</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">return</span> <span style="color:#ae81ff">13</span><span style="color:#111">,</span><span style="color:#00a8c8">nil</span>  
  <span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#75af00">info</span>

  <span style="color:#75af00">data</span><span style="color:#111">.</span><span style="color:#75af00">result</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">work</span><span style="color:#111">()</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;info: %+v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>prog.go:18: non-name data.result on left side of :=</p>
</blockquote>
<p>Even though there&rsquo;s a ticket to address this gotcha it&rsquo;s unlikely to change because Rob Pike likes it &ldquo;as is&rdquo; :-)</p>
<p>Use temporary variables or predeclare all your variables and use the standard assignment operator.</p>

  </div>

  <input type="radio" class="hidden" name="tabs-shortreassignvar" id="tabs-shortreassignvar-1"  />
  <label for="tabs-shortreassignvar-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">info</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
  <span style="color:#75af00">result</span> <span style="color:#00a8c8">int</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">work</span><span style="color:#111">()</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#00a8c8">error</span><span style="color:#111">)</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">return</span> <span style="color:#ae81ff">13</span><span style="color:#111">,</span><span style="color:#00a8c8">nil</span>  
  <span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#75af00">info</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">err</span> <span style="color:#00a8c8">error</span>
  <span style="color:#75af00">data</span><span style="color:#111">.</span><span style="color:#75af00">result</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#111">=</span> <span style="color:#75af00">work</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;info: %+v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: info: {result:13}
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
  </div>

</div>

<h2 id="7可能出现的变量阴影">7.可能出现的“变量阴影”</h2>
<p>Accidental Variable Shadowing</p>
<ul>
<li>level: beginner</li>
</ul>
<p>简短的变量声明语法非常方便（尤其是对于来自动态语言初学者写的代码），因此很容易将其视为常规赋值操作。<br>
如果在新的代码块中犯了此错误，将不会有编译器错误，但应用程序将无法得到期望结果。</p>
<p>参考：go变量作用域</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span>     <span style="color:#75715e">//prints 1
</span><span style="color:#75715e"></span>    <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span> <span style="color:#75715e">//prints 1
</span><span style="color:#75715e"></span>        <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span> <span style="color:#75715e">//prints 2
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span>     <span style="color:#75715e">//prints 1 (但实际上，你可能期望得到 2)
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>即使对于有经验的Go开发人员来说，这也是一个非常常见的陷阱，并且很容易触发，而且很难发现。<br>
可以使用<code>vet</code>命令来查找其中的一些问题。默认情况下，<code>vet</code>不执行任何阴影变量检查, 如需检查加上<code>-shadow</code>选项</p>
<blockquote>
<p><code>go tool vet -shadow your_file.go</code></p>
</blockquote>
<p>值得注意的是<code>vet</code>不会报出全部的 <code>shadowed variables</code>, 使用<a href="https://github.com/barakmich/go-nyet"><code>go-nyet</code></a> 是一个更好的 <code>shadowed variables</code> 检测工具。</p>
<h2 id="8不能使用nil来初始化没有显式类型的变量-var">8.不能使用“nil”来初始化没有显式类型的变量 var</h2>
<p>Can&rsquo;t Use &ldquo;nil&rdquo; to Initialize a Variable Without an Explicit Type</p>
<ul>
<li>level: beginner</li>
</ul>
<p>The &ldquo;nil&rdquo; identifier can be used as the &ldquo;zero value&rdquo; for interfaces, functions, pointers, maps, slices, and channels. If you don&rsquo;t specify the variable type the compiler will fail to compile your code because it can&rsquo;t guess the type.




<div class="book-tabs">

  <input type="radio" class="hidden" name="tabs-assignnil" id="tabs-assignnil-0" checked="checked" />
  <label for="tabs-assignnil-0">
    错误示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">x</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">x</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox188239583/main.go:4: use of untyped nil</p>
</blockquote>

  </div>

  <input type="radio" class="hidden" name="tabs-assignnil" id="tabs-assignnil-1"  />
  <label for="tabs-assignnil-1">
    正确示范
  </label>
  <div class="book-tabs-content markdown-inner">
    <div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">x</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>

    <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">x</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
  </div>

</div>
</p>
<h2 id="9using-nil-slices-and-maps">9.Using &ldquo;nil&rdquo; Slices and Maps</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>It&rsquo;s OK to add items to a &ldquo;nil&rdquo; slice, but doing the same with a map will produce a runtime panic.</p>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">s</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span>
    <span style="color:#75af00">s</span> <span style="color:#111">=</span> <span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#75af00">s</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">m</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span>
    <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="map-capacity">Map Capacity</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>You can specify the map capacity when it&rsquo;s created, but you can&rsquo;t use the <code>cap()</code> function on maps.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#ae81ff">99</span><span style="color:#111">)</span>
    <span style="color:#111">cap</span><span style="color:#111">(</span><span style="color:#75af00">m</span><span style="color:#111">)</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox326543983/main.go:5: invalid argument m (type map[string]int) for cap</p>
</blockquote>
<h2 id="strings-cant-be-nil">Strings Can&rsquo;t Be &ldquo;nil&rdquo;</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>This is a gotcha for developers who are used to assigning &ldquo;nil&rdquo; identifiers to string variables.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">x</span> <span style="color:#00a8c8">string</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">x</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>        <span style="color:#75af00">x</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;default&#34;</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox630560459/main.go:4: cannot use nil as type string in assignment /tmp/sandbox630560459/main.go:6: invalid operation: x == nil (mismatched types string and nil)</p>
</blockquote>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">x</span> <span style="color:#00a8c8">string</span> <span style="color:#75715e">//defaults to &#34;&#34; (zero value)
</span><span style="color:#75715e"></span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">x</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;&#34;</span> <span style="color:#111">{</span>
        <span style="color:#75af00">x</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;default&#34;</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="array-function-arguments">Array Function Arguments</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>If you are a C or C++ developer arrays for you are pointers. When you pass arrays to functions the functions reference the same memory location, so they can update the original data. Arrays in Go are values, so when you pass arrays to functions the functions get a copy of the original array data. This can be a problem if you are trying to update the array data.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">arr</span> <span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">arr</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#ae81ff">7</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">arr</span><span style="color:#111">)</span> <span style="color:#75715e">//prints [7 2 3]
</span><span style="color:#75715e"></span>    <span style="color:#111">}(</span><span style="color:#75af00">x</span><span style="color:#111">)</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span> <span style="color:#75715e">//prints [1 2 3] (not ok if you need [7 2 3])
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you need to update the original array data use array pointer types.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">arr</span> <span style="color:#f92672">*</span><span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#75af00">arr</span><span style="color:#111">)[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#ae81ff">7</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">arr</span><span style="color:#111">)</span> <span style="color:#75715e">//prints &amp;[7 2 3]
</span><span style="color:#75715e"></span>    <span style="color:#111">}(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">x</span><span style="color:#111">)</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span> <span style="color:#75715e">//prints [7 2 3]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Another option is to use slices. Even though your function gets a copy of the slice variable it still references the original data.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">arr</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">arr</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#ae81ff">7</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">arr</span><span style="color:#111">)</span> <span style="color:#75715e">//prints [7 2 3]
</span><span style="color:#75715e"></span>    <span style="color:#111">}(</span><span style="color:#75af00">x</span><span style="color:#111">)</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span> <span style="color:#75715e">//prints [7 2 3]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="unexpected-values-in-slice-and-array-range-clauses">Unexpected Values in Slice and Array &ldquo;range&rdquo; Clauses</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>This can happen if you are used to the &ldquo;for-in&rdquo; or &ldquo;foreach&rdquo; statements in other languages. The &ldquo;range&rdquo; clause in Go is different. It generates two values: the first value is the item index while the second value is the item data.</p>
<p>Bad:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;a&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;b&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;c&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">x</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">v</span><span style="color:#111">)</span> <span style="color:#75715e">//prints 0, 1, 2
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Good:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;a&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;b&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;c&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span> <span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">x</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">v</span><span style="color:#111">)</span> <span style="color:#75715e">//prints a, b, c
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="slices-and-arrays-are-one-dimensional">Slices and Arrays Are One-Dimensional</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>It may seem like Go supports multi-dimensional arrays and slices, but it doesn&rsquo;t. Creating arrays of arrays or slices of slices is possible though. For numerical computation apps that rely on dynamic multi-dimensional arrays it&rsquo;s far from ideal in terms of performance and complexity.</p>
<p>You can build dynamic multi-dimensional arrays using raw one-dimensional arrays, slices of &ldquo;independent&rdquo; slices, and slices of &ldquo;shared data&rdquo; slices.</p>
<p>If you are using raw one-dimensional arrays you are responsible for indexing, bounds checking, and memory reallocations when the arrays need to grow.</p>
<p>Creating a dynamic multi-dimensional array using slices of &ldquo;independent&rdquo; slices is a two step process. First, you have to create the outer slice. Then, you have to allocate each inner slice. The inner slices are independent of each other. You can grow and shrink them without affecting other inner slices.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>
    <span style="color:#75af00">y</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">4</span>

    <span style="color:#75af00">table</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">([][]</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#75af00">x</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span><span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">table</span> <span style="color:#111">{</span>
        <span style="color:#75af00">table</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#111">make</span><span style="color:#111">([]</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#75af00">y</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Creating a dynamic multi-dimensional array using slices of &ldquo;shared data&rdquo; slices is a three step process. First, you have to create the data &ldquo;container&rdquo; slice that will hold raw data. Then, you create the outer slice. Finally, you initialize each inner slice by reslicing the raw data slice.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">h</span><span style="color:#111">,</span> <span style="color:#75af00">w</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#ae81ff">4</span>

    <span style="color:#75af00">raw</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">([]</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#75af00">h</span><span style="color:#f92672">*</span><span style="color:#75af00">w</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">raw</span> <span style="color:#111">{</span>
        <span style="color:#75af00">raw</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#75af00">i</span>
    <span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">raw</span><span style="color:#111">[</span><span style="color:#ae81ff">4</span><span style="color:#111">])</span>
    <span style="color:#75715e">//prints: [0 1 2 3 4 5 6 7] &lt;ptr_addr_x&gt;
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">table</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">([][]</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#75af00">h</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span><span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">table</span> <span style="color:#111">{</span>
        <span style="color:#75af00">table</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#75af00">raw</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#f92672">*</span><span style="color:#75af00">w</span><span style="color:#111">:</span><span style="color:#75af00">i</span><span style="color:#f92672">*</span><span style="color:#75af00">w</span> <span style="color:#f92672">+</span> <span style="color:#75af00">w</span><span style="color:#111">]</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">table</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">table</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">][</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span>
    <span style="color:#75715e">//prints: [[0 1 2 3] [4 5 6 7]] &lt;ptr_addr_x&gt;
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>There&rsquo;s a spec/proposal for multi-dimensional arrays and slices, but it looks like it&rsquo;s a low priority feature at this point in time.</p>
<h2 id="accessing-non-existing-map-keys">Accessing Non-Existing Map Keys</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>This is a gotcha for developers who expect to get &ldquo;nil&rdquo; identifiers (like it&rsquo;s done in other languages). The returned value will be &ldquo;nil&rdquo; if the &ldquo;zero value&rdquo; for the corresponding data type is &ldquo;nil&rdquo;, but it&rsquo;ll be different for other data types. Checking for the appropriate &ldquo;zero value&rdquo; can be used to determine if the map record exists, but it&rsquo;s not always reliable (e.g., what do you do if you have a map of booleans where the &ldquo;zero value&rdquo; is false). The most reliable way to know if a given map record exists is to check the second value returned by the map access operation.</p>
<p>Bad:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">:</span><span style="color:#d88200">&#34;a&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">:</span><span style="color:#d88200">&#34;&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">:</span><span style="color:#d88200">&#34;c&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">x</span><span style="color:#111">[</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">];</span> <span style="color:#75af00">v</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;&#34;</span> <span style="color:#111">{</span> <span style="color:#75715e">//incorrect
</span><span style="color:#75715e"></span>        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;no entry&#34;</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Good:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">:</span><span style="color:#d88200">&#34;a&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">:</span><span style="color:#d88200">&#34;&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">:</span><span style="color:#d88200">&#34;c&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">ok</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">x</span><span style="color:#111">[</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">];</span> <span style="color:#111">!</span><span style="color:#75af00">ok</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;no entry&#34;</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="strings-are-immutable">Strings Are Immutable</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Trying to update an individual character in a string variable using the index operator will result in a failure. Strings are read-only byte slices (with a few extra properties). If you do need to update a string then use a byte slice instead converting it to a string type when necessary.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;text&#34;</span>
    <span style="color:#75af00">x</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#d88200">&#39;T&#39;</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox305565531/main.go:7: cannot assign to x[0]</p>
</blockquote>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;text&#34;</span>
    <span style="color:#75af00">xbytes</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">)</span>
    <span style="color:#75af00">xbytes</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#d88200">&#39;T&#39;</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">xbytes</span><span style="color:#111">))</span> <span style="color:#75715e">//prints Text
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that this isn&rsquo;t really the right way to update characters in a text string because a given character could be stored in multiple bytes. If you do need to make updates to a text string convert it to a rune slice first. Even with rune slices a single character might span multiple runes, which can happen if you have characters with grave accent, for example. This complicated and ambiguous nature of &ldquo;characters&rdquo; is the reason why Go strings are represented as byte sequences.</p>
<h2 id="conversions-between-strings-and-byte-slices">Conversions Between Strings and Byte Slices</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>When you convert a string to a byte slice (and vice versa) you get a complete copy of the orginal data. It&rsquo;s not like a cast operation in other languages and it&rsquo;s not like reslicing where the new slice variable points to the same underlying array used by the original byte slice.</p>
<p>Go does have a couple of optimizations for <code>[]byte</code> to <code>string</code> and <code>string</code> to <code>[]byte</code> conversions to avoid extra allocations (with more optimizations on the todo list).</p>
<p>The first optimization avoids extra allocations when <code>[]byte</code> keys are used to lookup entries in <code>map[string]</code> collections: <code>m[string(key)]</code>.</p>
<p>The second optimization avoids extra allocations in <code>for range</code> clauses where strings are converted to <code>[]byte</code>: <code>for i,v := range []byte(str) {...}</code>.</p>
<h2 id="strings-and-index-operator">Strings and Index Operator</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>The index operator on a string returns a byte value, not a character (like it&rsquo;s done in other languages).</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;text&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">x</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span> <span style="color:#75715e">//print 116
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%T&#34;</span><span style="color:#111">,</span><span style="color:#75af00">x</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span> <span style="color:#75715e">//prints uint8
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you need to access specific string &ldquo;characters&rdquo; (unicode code points/runes) use the <code>for range</code> clause. The official &ldquo;unicode/utf8&rdquo; package and the experimental utf8string package (golang.org/x/exp/utf8string) are also useful. The utf8string package includes a convenient <code>At()</code> method. Converting the string to a slice of runes is an option too.</p>
<h2 id="strings-are-not-always-utf8-text">Strings Are Not Always UTF8 Text</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>String values are not required to be UTF8 text. They can contain arbitrary bytes. The only time strings are UTF8 is when string literals are used. Even then they can include other data using escape sequences.</p>
<p>To know if you have a UTF8 text string use the <code>ValidString()</code> function from the &ldquo;unicode/utf8&rdquo; package.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;unicode/utf8&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data1</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;ABC&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">utf8</span><span style="color:#111">.</span><span style="color:#75af00">ValidString</span><span style="color:#111">(</span><span style="color:#75af00">data1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: true
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">data2</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;A\xfeC&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">utf8</span><span style="color:#111">.</span><span style="color:#75af00">ValidString</span><span style="color:#111">(</span><span style="color:#75af00">data2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: false
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="string-length">String Length</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Let&rsquo;s say you are a python developer and you have the following piece of code:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">data = u&#39;♥&#39;  
print(len(data)) #prints: 1  
</code></pre></td></tr></table>
</div>
</div><p>When you convert it to a similar Go code snippet you might be surprised.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;♥&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: 3
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The built-in <code>len()</code> function returns the number of bytes instead of the number of characters like it&rsquo;s done for unicode strings in Python.</p>
<p>To get the same results in Go use the <code>RuneCountInString()</code> function from the &ldquo;unicode/utf8&rdquo; package.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;unicode/utf8&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;♥&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">utf8</span><span style="color:#111">.</span><span style="color:#75af00">RuneCountInString</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: 1
</span></code></pre></td></tr></table>
</div>
</div><p>Technically the <code>RuneCountInString()</code> function doesn&rsquo;t return the number of characters because a single character may span multiple runes.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;unicode/utf8&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;é&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">))</span>                    <span style="color:#75715e">//prints: 3
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">utf8</span><span style="color:#111">.</span><span style="color:#75af00">RuneCountInString</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: 2
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="missing-comma-in-multi-line-slice-array-and-map-literals">Missing Comma In Multi-Line Slice, Array, and Map Literals</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span>
    <span style="color:#ae81ff">1</span><span style="color:#111">,</span>
    <span style="color:#ae81ff">2</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
    <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">x</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox367520156/main.go:6: syntax error: need trailing comma before newline in composite literal /tmp/sandbox367520156/main.go:8: non-declaration statement outside function body /tmp/sandbox367520156/main.go:9: syntax error: unexpected }</p>
</blockquote>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">x</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span>
    <span style="color:#ae81ff">1</span><span style="color:#111">,</span>
    <span style="color:#ae81ff">2</span><span style="color:#111">,</span>
    <span style="color:#111">}</span>
    <span style="color:#75af00">x</span> <span style="color:#111">=</span> <span style="color:#75af00">x</span>

    <span style="color:#75af00">y</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">4</span><span style="color:#111">,}</span> <span style="color:#75715e">//no error
</span><span style="color:#75715e"></span>    <span style="color:#75af00">y</span> <span style="color:#111">=</span> <span style="color:#75af00">y</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You won&rsquo;t get a compiler error if you leave the trailing comma when you collapse the declaration to be on a single line.</p>
<h2 id="logfatal-and-logpanic-do-more-than-log">log.Fatal and log.Panic Do More Than Log</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Logging libraries often provide different log levels. Unlike those logging libraries, the log package in Go does more than log if you call its <code>Fatal*()</code> and <code>Panic*()</code> functions. When your app calls those functions Go will also terminate your app :-)</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;log&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">log</span><span style="color:#111">.</span><span style="color:#75af00">Fatalln</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Fatal Level: log entry&#34;</span><span style="color:#111">)</span> <span style="color:#75715e">//app exits here
</span><span style="color:#75715e"></span>    <span style="color:#75af00">log</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;Normal Level: log entry&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="built-in-data-structure-operations-are-not-synchronized">Built-in Data Structure Operations Are Not Synchronized</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Even though Go has a number of features to support concurrency natively, concurrency safe data collections are not one them :-) It&rsquo;s your responsibility to ensure the data collection updates are atomic. Goroutines and channels are the recommended way to implement those atomic operations, but you can also leverage the &ldquo;sync&rdquo; package if it makes sense for your application.</p>
<h2 id="iteration-values-for-strings-in-range-clauses">Iteration Values For Strings in &ldquo;range&rdquo; Clauses</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>The index value (the first value returned by the &ldquo;range&rdquo; operation) is the index of the first byte for the current &ldquo;character&rdquo; (unicode code point/rune) returned in the second value. It&rsquo;s not the index for the current &ldquo;character&rdquo; like it&rsquo;s done in other languages. Note that an actual character might be represented by multiple runes. Make sure to check out the &ldquo;norm&rdquo; package (golang.org/x/text/unicode/norm) if you need to work with characters.</p>
<p>The <code>for range</code> clauses with string variables will try to interpret the data as UTF8 text. For any byte sequences it doesn&rsquo;t understand it will return 0xfffd runes (aka unicode replacement characters) instead of the actual data. If you have arbitrary (non-UTF8 text) data stored in your string variables, make sure to convert them to byte slices to get all stored data as is.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;A\xfe\x02\xff\x04&#34;</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%#x &#34;</span><span style="color:#111">,</span><span style="color:#75af00">v</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
    <span style="color:#75715e">//prints: 0x41 0xfffd 0x2 0xfffd 0x4 (not ok)
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">()</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%#x &#34;</span><span style="color:#111">,</span><span style="color:#75af00">v</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
    <span style="color:#75715e">//prints: 0x41 0xfe 0x2 0xff 0x4 (good)
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="iterating-through-a-map-using-a-for-range-clause">Iterating Through a Map Using a &ldquo;for range&rdquo; Clause</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>This is a gotcha if you expect the items to be in a certain order (e.g., ordered by the key value). Each map iteration will produce different results. The Go runtime tries to go an extra mile randomizing the iteration order, but it doesn&rsquo;t always succeed so you may get several identical map iterations. Don&rsquo;t be surprised to see 5 identical iterations in a row.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">:</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">:</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">:</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#d88200">&#34;four&#34;</span><span style="color:#111">:</span><span style="color:#ae81ff">4</span><span style="color:#111">}</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">k</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">m</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">k</span><span style="color:#111">,</span><span style="color:#75af00">v</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>And if you use the Go Playground (<a href="https://play.golang.org/">https://play.golang.org/</a>) you&rsquo;ll always get the same results because it doesn&rsquo;t recompile the code unless you make a change.</p>
<h2 id="fallthrough-behavior-in-switch-statements">Fallthrough Behavior in &ldquo;switch&rdquo; Statements</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>The &ldquo;case&rdquo; blocks in &ldquo;switch&rdquo; statements break by default. This is different from other languages where the default behavior is to fall through to the next &ldquo;case&rdquo; block.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">isSpace</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">ch</span> <span style="color:#00a8c8">byte</span><span style="color:#111">)</span> <span style="color:#00a8c8">bool</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">switch</span><span style="color:#111">(</span><span style="color:#75af00">ch</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39; &#39;</span><span style="color:#111">:</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;\t&#39;</span><span style="color:#111">:</span>
            <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">true</span>
        <span style="color:#111">}</span>
        <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">false</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">isSpace</span><span style="color:#111">(</span><span style="color:#d88200">&#39;\t&#39;</span><span style="color:#111">))</span> <span style="color:#75715e">//prints true (ok)
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">isSpace</span><span style="color:#111">(</span><span style="color:#d88200">&#39; &#39;</span><span style="color:#111">))</span>  <span style="color:#75715e">//prints false (not ok)
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can force the &ldquo;case&rdquo; blocks to fall through by using the &ldquo;fallthrough&rdquo; statement at the end of each &ldquo;case&rdquo; block. You can also rewrite your switch statement to use expression lists in the &ldquo;case&rdquo; blocks.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">isSpace</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">ch</span> <span style="color:#00a8c8">byte</span><span style="color:#111">)</span> <span style="color:#00a8c8">bool</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">switch</span><span style="color:#111">(</span><span style="color:#75af00">ch</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39; &#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;\t&#39;</span><span style="color:#111">:</span>
            <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">true</span>
        <span style="color:#111">}</span>
        <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">false</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">isSpace</span><span style="color:#111">(</span><span style="color:#d88200">&#39;\t&#39;</span><span style="color:#111">))</span> <span style="color:#75715e">//prints true (ok)
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">isSpace</span><span style="color:#111">(</span><span style="color:#d88200">&#39; &#39;</span><span style="color:#111">))</span>  <span style="color:#75715e">//prints true (ok)
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="increments-and-decrements">Increments and Decrements</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Many languages have increment and decrement operators. Unlike other languages, Go doesn&rsquo;t support the prefix version of the operations. You also can&rsquo;t use these two operators in expressions.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>
    <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#f92672">++</span><span style="color:#75af00">i</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#f92672">++</span><span style="color:#111">])</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox101231828/main.go:8: syntax error: unexpected ++ /tmp/sandbox101231828/main.go:9: syntax error: unexpected ++, expecting :</p>
</blockquote>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>
    <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#75af00">i</span><span style="color:#f92672">++</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#111">])</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="bitwise-not-operator">Bitwise NOT Operator</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Many languages use <code>~</code> as the unary NOT operator (aka bitwise complement), but Go reuses the XOR operator (<code>^</code>) for that.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#960050;background-color:#1e0010">~</span><span style="color:#ae81ff">2</span><span style="color:#111">)</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox965529189/main.go:6: the bitwise complement operator is ^</p>
</blockquote>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">d</span> <span style="color:#00a8c8">uint8</span> <span style="color:#111">=</span> <span style="color:#ae81ff">2</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b\n&#34;</span><span style="color:#111">,^</span><span style="color:#75af00">d</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Go still uses <code>^</code> as the XOR operator, which may be confusing for some people.</p>
<p>If you want you can represent a unary NOT operation (e.g, <code>NOT 0x02</code>) with a binary XOR operation (e.g., <code>0x02 XOR 0xff</code>). This could explain why <code>^</code> is reused to represent unary NOT operations.</p>
<p>Go also has a special &lsquo;AND NOT&rsquo; bitwise operator (<code>&amp;^</code>), which adds to the NOT operator confusion. It looks like a special feature/hack to support <code>A AND (NOT B)</code> without requiring parentheses.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">a</span> <span style="color:#00a8c8">uint8</span> <span style="color:#111">=</span> <span style="color:#ae81ff">0x82</span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">b</span> <span style="color:#00a8c8">uint8</span> <span style="color:#111">=</span> <span style="color:#ae81ff">0x02</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b [A]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">a</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b [B]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">)</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b (NOT B)\n&#34;</span><span style="color:#111">,^</span><span style="color:#75af00">b</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b ^ %08b = %08b [B XOR 0xff]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">,</span><span style="color:#ae81ff">0xff</span><span style="color:#111">,</span><span style="color:#75af00">b</span> <span style="color:#111">^</span> <span style="color:#ae81ff">0xff</span><span style="color:#111">)</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b ^ %08b = %08b [A XOR B]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">a</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">,</span><span style="color:#75af00">a</span> <span style="color:#111">^</span> <span style="color:#75af00">b</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b &amp; %08b = %08b [A AND B]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">a</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">,</span><span style="color:#75af00">a</span> <span style="color:#f92672">&amp;</span> <span style="color:#75af00">b</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b &amp;^%08b = %08b [A &#39;AND NOT&#39; B]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">a</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">,</span><span style="color:#75af00">a</span> <span style="color:#f92672">&amp;^</span> <span style="color:#75af00">b</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%08b&amp;(^%08b)= %08b [A AND (NOT B)]\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">a</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">,</span><span style="color:#75af00">a</span> <span style="color:#f92672">&amp;</span> <span style="color:#111">(^</span><span style="color:#75af00">b</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="operator-precedence-differences">Operator Precedence Differences</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Aside from the &ldquo;bit clear&rdquo; operators (<code>&amp;^</code>) Go has a set of standard operators shared by many other languages. The operator precedence is not always the same though.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;0x2 &amp; 0x2 + 0x4 -&gt; %#x\n&#34;</span><span style="color:#111">,</span><span style="color:#ae81ff">0x2</span> <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x4</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints: 0x2 &amp; 0x2 + 0x4 -&gt; 0x6
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Go:    (0x2 &amp; 0x2) + 0x4
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//C++:    0x2 &amp; (0x2 + 0x4) -&gt; 0x2
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;0x2 + 0x2 &lt;&lt; 0x1 -&gt; %#x\n&#34;</span><span style="color:#111">,</span><span style="color:#ae81ff">0x2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x2</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0x1</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints: 0x2 + 0x2 &lt;&lt; 0x1 -&gt; 0x6
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Go:     0x2 + (0x2 &lt;&lt; 0x1)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//C++:   (0x2 + 0x2) &lt;&lt; 0x1 -&gt; 0x8
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;0xf | 0x2 ^ 0x2 -&gt; %#x\n&#34;</span><span style="color:#111">,</span><span style="color:#ae81ff">0xf</span> <span style="color:#111">|</span> <span style="color:#ae81ff">0x2</span> <span style="color:#111">^</span> <span style="color:#ae81ff">0x2</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints: 0xf | 0x2 ^ 0x2 -&gt; 0xd
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Go:    (0xf | 0x2) ^ 0x2
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//C++:    0xf | (0x2 ^ 0x2) -&gt; 0xf
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="unexported-structure-fields-are-not-encoded">Unexported Structure Fields Are Not Encoded</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>The struct fields starting with lowercase letters will not be (json, xml, gob, etc.) encoded, so when you decode the structure you&rsquo;ll end up with zero values in those unexported fields.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;encoding/json&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">MyData</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">One</span> <span style="color:#00a8c8">int</span>
    <span style="color:#75af00">two</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">in</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">MyData</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%#v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">in</span><span style="color:#111">)</span> <span style="color:#75715e">//prints main.MyData{One:1, two:&#34;two&#34;}
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">encoded</span><span style="color:#111">,</span><span style="color:#75af00">_</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Marshal</span><span style="color:#111">(</span><span style="color:#75af00">in</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">encoded</span><span style="color:#111">))</span> <span style="color:#75715e">//prints {&#34;One&#34;:1}
</span><span style="color:#75715e"></span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">out</span> <span style="color:#75af00">MyData</span>
    <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">encoded</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">out</span><span style="color:#111">)</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%#v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">out</span><span style="color:#111">)</span> <span style="color:#75715e">//prints main.MyData{One:1, two:&#34;&#34;}
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="app-exits-with-active-goroutines">App Exits With Active Goroutines</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>The app will not wait for all your goroutines to complete. This is a common mistake for beginners in general. Everybody starts somewhere, so there&rsquo;s no shame in making rookie mistakes :-)</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">workerCount</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#75af00">workerCount</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#75af00">i</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>
    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;all done!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#75af00">workerId</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] is running\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">)</span>
    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] is done\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You&rsquo;ll see:</p>
<blockquote>
<p>[0] is running
[1] is running
all done!</p>
</blockquote>
<p>One of the most common solutions is to use a &ldquo;WaitGroup&rdquo; variable. It will allow the main goroutine to wait until all worker goroutines are done. If your app has long running workers with message processing loops you&rsquo;ll also need a way to signal those goroutines that it&rsquo;s time to exit. You can send a &ldquo;kill&rdquo; message to each worker. Another option is to close a channel all workers are receiving from. It&rsquo;s a simple way to signal all goroutines at once.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;sync&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">wg</span> <span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">WaitGroup</span>
    <span style="color:#75af00">done</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">struct</span><span style="color:#111">{})</span>
    <span style="color:#75af00">workerCount</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#75af00">workerCount</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#75af00">wg</span><span style="color:#111">.</span><span style="color:#75af00">Add</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">go</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#75af00">i</span><span style="color:#111">,</span><span style="color:#75af00">done</span><span style="color:#111">,</span><span style="color:#75af00">wg</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#111">close</span><span style="color:#111">(</span><span style="color:#75af00">done</span><span style="color:#111">)</span>
    <span style="color:#75af00">wg</span><span style="color:#111">.</span><span style="color:#75af00">Wait</span><span style="color:#111">()</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;all done!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#75af00">workerId</span> <span style="color:#00a8c8">int</span><span style="color:#111">,</span><span style="color:#75af00">done</span> <span style="color:#f92672">&lt;-</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">struct</span><span style="color:#111">{},</span><span style="color:#75af00">wg</span> <span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">WaitGroup</span><span style="color:#111">)</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] is running\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">defer</span> <span style="color:#75af00">wg</span><span style="color:#111">.</span><span style="color:#75af00">Done</span><span style="color:#111">()</span>
    <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">done</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] is done\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you run this app you&rsquo;ll see:</p>
<blockquote>
<p>[0] is running
[0] is done
[1] is running
[1] is done</p>
</blockquote>
<p>Looks like the workers are done before the main goroutine exits. Great! However, you&rsquo;ll also see this:</p>
<blockquote>
<p>fatal error: all goroutines are asleep - deadlock!</p>
</blockquote>
<p>That&rsquo;s not so great :-) What&rsquo;s going on? Why is there a deadlock? The workers exited and they executed <code>wg.Done()</code>. The app should work.</p>
<p>The deadlock happens because each worker gets a copy of the original &ldquo;WaitGroup&rdquo; variable. When workers execute <code>wg.Done()</code> it has no effect on the &ldquo;WaitGroup&rdquo; variable in the main goroutine.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;sync&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">wg</span> <span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">WaitGroup</span>
    <span style="color:#75af00">done</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">struct</span><span style="color:#111">{})</span>
    <span style="color:#75af00">wq</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{})</span>
    <span style="color:#75af00">workerCount</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#75af00">workerCount</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#75af00">wg</span><span style="color:#111">.</span><span style="color:#75af00">Add</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">go</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#75af00">i</span><span style="color:#111">,</span><span style="color:#75af00">wq</span><span style="color:#111">,</span><span style="color:#75af00">done</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">wg</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#75af00">workerCount</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#75af00">wq</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">i</span>
    <span style="color:#111">}</span>

    <span style="color:#111">close</span><span style="color:#111">(</span><span style="color:#75af00">done</span><span style="color:#111">)</span>
    <span style="color:#75af00">wg</span><span style="color:#111">.</span><span style="color:#75af00">Wait</span><span style="color:#111">()</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;all done!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#75af00">workerId</span> <span style="color:#00a8c8">int</span><span style="color:#111">,</span> <span style="color:#75af00">wq</span> <span style="color:#f92672">&lt;-</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{},</span><span style="color:#75af00">done</span> <span style="color:#f92672">&lt;-</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">struct</span><span style="color:#111">{},</span><span style="color:#75af00">wg</span> <span style="color:#f92672">*</span><span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">WaitGroup</span><span style="color:#111">)</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] is running\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">defer</span> <span style="color:#75af00">wg</span><span style="color:#111">.</span><span style="color:#75af00">Done</span><span style="color:#111">()</span>
    <span style="color:#00a8c8">for</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">select</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">case</span> <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">wq</span><span style="color:#111">:</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] m =&gt; %v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">,</span><span style="color:#75af00">m</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">case</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">done</span><span style="color:#111">:</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] is done\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">workerId</span><span style="color:#111">)</span>
            <span style="color:#00a8c8">return</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Now it works as expected :-)</p>
<h2 id="sending-to-an-unbuffered-channel-returns-as-soon-as-the-target-receiver-is-ready">Sending to an Unbuffered Channel Returns As Soon As the Target Receiver Is Ready</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>The sender will not be blocked until your message is processed by the receiver. Depending on the machine where you are running the code, the receiver goroutine may or may not have enough time to process the message before the sender continues its execution.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">ch</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">string</span><span style="color:#111">)</span>

    <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">for</span> <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">ch</span> <span style="color:#111">{</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;processed:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">m</span><span style="color:#111">)</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}()</span>

    <span style="color:#75af00">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#d88200">&#34;cmd.1&#34;</span>
    <span style="color:#75af00">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#d88200">&#34;cmd.2&#34;</span> <span style="color:#75715e">//won&#39;t be processed
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="sending-to-an-closed-channel-causes-a-panic">Sending to an Closed Channel Causes a Panic</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Receiving from a closed channel is safe. The <code>ok</code> return value in a receive statement will be set to <code>false</code> indicating that no data was received. If you are receiving from a buffered channel you&rsquo;ll get the buffered data first and once it&rsquo;s empty the <code>ok</code> return value will be <code>false</code>.</p>
<p>Sending data to a closed channel causes a panic. It is a documented behavior, but it&rsquo;s not very intuitive for new Go developers who might expect the send behavior to be similar to the receive behavior.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">ch</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#ae81ff">3</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">idx</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#75af00">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#111">(</span><span style="color:#75af00">idx</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
        <span style="color:#111">}(</span><span style="color:#75af00">i</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#75715e">//get the first result
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#f92672">&lt;-</span><span style="color:#75af00">ch</span><span style="color:#111">)</span>
    <span style="color:#111">close</span><span style="color:#111">(</span><span style="color:#75af00">ch</span><span style="color:#111">)</span> <span style="color:#75715e">//not ok (you still have other senders)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//do other work
</span><span style="color:#75715e"></span>    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Depending on your application the fix will be different. It might be a minor code change or it might require a change in your application design. Either way, you&rsquo;ll need to make sure your application doesn&rsquo;t try to send data to a closed channel.</p>
<p>The buggy example can be fixed by using a special cancellation channel to signal the remaining workers that their results are no longer neeeded.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">ch</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span>
    <span style="color:#75af00">done</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">struct</span><span style="color:#111">{})</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#ae81ff">3</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">idx</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">select</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">case</span> <span style="color:#75af00">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#111">(</span><span style="color:#75af00">idx</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#111">:</span> <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">idx</span><span style="color:#111">,</span><span style="color:#d88200">&#34;sent result&#34;</span><span style="color:#111">)</span>
            <span style="color:#00a8c8">case</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">done</span><span style="color:#111">:</span> <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">idx</span><span style="color:#111">,</span><span style="color:#d88200">&#34;exiting&#34;</span><span style="color:#111">)</span>
            <span style="color:#111">}</span>
        <span style="color:#111">}(</span><span style="color:#75af00">i</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#75715e">//get first result
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;result:&#34;</span><span style="color:#111">,</span><span style="color:#f92672">&lt;-</span><span style="color:#75af00">ch</span><span style="color:#111">)</span>
    <span style="color:#111">close</span><span style="color:#111">(</span><span style="color:#75af00">done</span><span style="color:#111">)</span>
    <span style="color:#75715e">//do other work
</span><span style="color:#75715e"></span>    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="using-nil-channels">Using &ldquo;nil&rdquo; Channels</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Send and receive operations on a <code>nil</code> channel block forver. It&rsquo;s a well documented behavior, but it can be a surprise for new Go developers.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">ch</span> <span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">int</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75af00">i</span> <span style="color:#111">&lt;</span> <span style="color:#ae81ff">3</span><span style="color:#111">;</span> <span style="color:#75af00">i</span><span style="color:#f92672">++</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">idx</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#75af00">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#111">(</span><span style="color:#75af00">idx</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
        <span style="color:#111">}(</span><span style="color:#75af00">i</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#75715e">//get first result
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;result:&#34;</span><span style="color:#111">,</span><span style="color:#f92672">&lt;-</span><span style="color:#75af00">ch</span><span style="color:#111">)</span>
    <span style="color:#75715e">//do other work
</span><span style="color:#75715e"></span>    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you run the code you&rsquo;ll see a runtime error like this: <code>fatal error: all goroutines are asleep - deadlock!</code></p>
<p>This behavior can be used as a way to dynamically enable and disable <code>case</code> blocks in a <code>select</code> statement.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>  
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;time&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">inch</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span>
    <span style="color:#75af00">outch</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span>

    <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">var</span> <span style="color:#75af00">in</span> <span style="color:#f92672">&lt;-</span> <span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">int</span> <span style="color:#111">=</span> <span style="color:#75af00">inch</span>
        <span style="color:#00a8c8">var</span> <span style="color:#75af00">out</span> <span style="color:#00a8c8">chan</span> <span style="color:#f92672">&lt;-</span> <span style="color:#00a8c8">int</span>
        <span style="color:#00a8c8">var</span> <span style="color:#75af00">val</span> <span style="color:#00a8c8">int</span>
        <span style="color:#00a8c8">for</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">select</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">case</span> <span style="color:#75af00">out</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">val</span><span style="color:#111">:</span>
                <span style="color:#75af00">out</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>
                <span style="color:#75af00">in</span> <span style="color:#111">=</span> <span style="color:#75af00">inch</span>
            <span style="color:#00a8c8">case</span> <span style="color:#75af00">val</span> <span style="color:#111">=</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">in</span><span style="color:#111">:</span>
                <span style="color:#75af00">out</span> <span style="color:#111">=</span> <span style="color:#75af00">outch</span>
                <span style="color:#75af00">in</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>
            <span style="color:#111">}</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}()</span>

    <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">for</span> <span style="color:#75af00">r</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">outch</span> <span style="color:#111">{</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;result:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">r</span><span style="color:#111">)</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}()</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>
    <span style="color:#75af00">inch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
    <span style="color:#75af00">inch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2</span>
    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="methods-with-value-receivers-cant-change-the-original-value">Methods with Value Receivers Can&rsquo;t Change the Original Value</h2>
<ul>
<li>level: beginner</li>
</ul>
<p>Method receivers are like regular function arguments. If it&rsquo;s declared to be a value then your function/method gets a copy of your receiver argument. This means making changes to the receiver will not affect the original value unless your receiver is a map or slice variable and you are updating the items in the collection or the fields you are updating in the receiver are pointers.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">num</span> <span style="color:#00a8c8">int</span>
    <span style="color:#75af00">key</span> <span style="color:#f92672">*</span><span style="color:#00a8c8">string</span>
    <span style="color:#75af00">items</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">bool</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">this</span> <span style="color:#f92672">*</span><span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#75af00">pmethod</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">this</span><span style="color:#111">.</span><span style="color:#75af00">num</span> <span style="color:#111">=</span> <span style="color:#ae81ff">7</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">this</span> <span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#75af00">vmethod</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">this</span><span style="color:#111">.</span><span style="color:#75af00">num</span> <span style="color:#111">=</span> <span style="color:#ae81ff">8</span>
    <span style="color:#f92672">*</span><span style="color:#75af00">this</span><span style="color:#111">.</span><span style="color:#75af00">key</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;v.key&#34;</span>
    <span style="color:#75af00">this</span><span style="color:#111">.</span><span style="color:#75af00">items</span><span style="color:#111">[</span><span style="color:#d88200">&#34;vmethod&#34;</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#00a8c8">true</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">key</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;key.1&#34;</span>
    <span style="color:#75af00">d</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">key</span><span style="color:#111">,</span><span style="color:#111">make</span><span style="color:#111">(</span><span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">bool</span><span style="color:#111">)}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;num=%v key=%v items=%v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">num</span><span style="color:#111">,</span><span style="color:#f92672">*</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">key</span><span style="color:#111">,</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">items</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints num=1 key=key.1 items=map[]
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">pmethod</span><span style="color:#111">()</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;num=%v key=%v items=%v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">num</span><span style="color:#111">,</span><span style="color:#f92672">*</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">key</span><span style="color:#111">,</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">items</span><span style="color:#111">)</span> 
    <span style="color:#75715e">//prints num=7 key=key.1 items=map[]
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">vmethod</span><span style="color:#111">()</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;num=%v key=%v items=%v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">num</span><span style="color:#111">,</span><span style="color:#f92672">*</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">key</span><span style="color:#111">,</span><span style="color:#75af00">d</span><span style="color:#111">.</span><span style="color:#75af00">items</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints num=7 key=v.key items=map[vmethod:true]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="closing-http-response-body">Closing HTTP Response Body</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>When you make requests using the standard http library you get a http response variable. If you don&rsquo;t read the response body you still need to close it. Note that you must do it for empty responses too. It&rsquo;s very easy to forget especially for new Go developers.</p>
<p>Some new Go developers do try to close the response body, but they do it in the wrong place.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;net/http&#34;</span>
    <span style="color:#d88200">&#34;io/ioutil&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">resp</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">Get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;https://api.ipify.org?format=json&#34;</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">defer</span> <span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span><span style="color:#75715e">//not ok
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">body</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">ioutil</span><span style="color:#111">.</span><span style="color:#75af00">ReadAll</span><span style="color:#111">(</span><span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">body</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This code works for successful requests, but if the http request fails the <code>resp</code> variable might be <code>nil</code>, which will cause a runtime panic.</p>
<p>The most common why to close the response body is by using a <code>defer</code> call after the http response error check.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;net/http&#34;</span>
    <span style="color:#d88200">&#34;io/ioutil&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">resp</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">Get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;https://api.ipify.org?format=json&#34;</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">defer</span> <span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span><span style="color:#75715e">//ok, most of the time :-)
</span><span style="color:#75715e"></span>    <span style="color:#75af00">body</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">ioutil</span><span style="color:#111">.</span><span style="color:#75af00">ReadAll</span><span style="color:#111">(</span><span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">body</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Most of the time when your http request fails the <code>resp</code> variable will be <code>nil</code> and the <code>err</code> variable will be <code>non-nil</code>. However, when you get a redirection failure both variables will be <code>non-nil</code>. This means you can still end up with a leak.</p>
<p>You can fix this leak by adding a call to close <code>non-nil</code> response bodies in the http response error handling block. Another option is to use one <code>defer</code> call to close response bodies for all failed and successful requests.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;net/http&#34;</span>
    <span style="color:#d88200">&#34;io/ioutil&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">resp</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">Get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;https://api.ipify.org?format=json&#34;</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">resp</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">defer</span> <span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">body</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">ioutil</span><span style="color:#111">.</span><span style="color:#75af00">ReadAll</span><span style="color:#111">(</span><span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">body</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The orignal implementation for <code>resp.Body.Close()</code> also reads and discards the remaining response body data. This ensured that the http connection could be reused for another request if the keepalive http connection behavior is enabled. The latest http client behavior is different. Now it&rsquo;s your responsibility to read and discard the remaining response data. If you don&rsquo;t do it the http connection might be closed instead of being reused. This little gotcha is supposed to be documented in Go 1.5.</p>
<p>If reusing the http connection is important for your application you might need to add something like this at the end of your response processing logic:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">_, err = io.Copy(ioutil.Discard, resp.Body)  
</code></pre></td></tr></table>
</div>
</div><p>It will be necessary if you don&rsquo;t read the entire response body right away, which might happen if you are processing json API responses with code like this:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">json.NewDecoder(resp.Body).Decode(&amp;data)  
</code></pre></td></tr></table>
</div>
</div><h2 id="closing-http-connections">Closing HTTP Connections</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Some HTTP servers keep network connections open for a while (based on the HTTP 1.1 spec and the server &ldquo;keep-alive&rdquo; configurations). By default, the standard http library will close the network connections only when the target HTTP server asks for it. This means your app may run out of sockets/file descriptors under certain conditions.</p>
<p>You can ask the http library to close the connection after your request is done by setting the <code>Close</code> field in the request variable to <code>true</code>.</p>
<p>Another option is to add a <code>Connection</code> request header and set it to <code>close</code>. The target HTTP server should respond with a <code>Connection: close</code> header too. When the http library sees this response header it will also close the connection.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;net/http&#34;</span>
    <span style="color:#d88200">&#34;io/ioutil&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">req</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">NewRequest</span><span style="color:#111">(</span><span style="color:#d88200">&#34;GET&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;http://golang.org&#34;</span><span style="color:#111">,</span><span style="color:#00a8c8">nil</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">req</span><span style="color:#111">.</span><span style="color:#75af00">Close</span> <span style="color:#111">=</span> <span style="color:#00a8c8">true</span>
    <span style="color:#75715e">//or do this:
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//req.Header.Add(&#34;Connection&#34;, &#34;close&#34;)
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">resp</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">DefaultClient</span><span style="color:#111">.</span><span style="color:#75af00">Do</span><span style="color:#111">(</span><span style="color:#75af00">req</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">resp</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">defer</span> <span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">body</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">ioutil</span><span style="color:#111">.</span><span style="color:#75af00">ReadAll</span><span style="color:#111">(</span><span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">body</span><span style="color:#111">)))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can also disable http connection reuse globally. You&rsquo;ll need to create a custom http transport configuration for it.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;net/http&#34;</span>
    <span style="color:#d88200">&#34;io/ioutil&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">tr</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">Transport</span><span style="color:#111">{</span><span style="color:#75af00">DisableKeepAlives</span><span style="color:#111">:</span> <span style="color:#00a8c8">true</span><span style="color:#111">}</span>
    <span style="color:#75af00">client</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">http</span><span style="color:#111">.</span><span style="color:#75af00">Client</span><span style="color:#111">{</span><span style="color:#75af00">Transport</span><span style="color:#111">:</span> <span style="color:#75af00">tr</span><span style="color:#111">}</span>

    <span style="color:#75af00">resp</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">client</span><span style="color:#111">.</span><span style="color:#75af00">Get</span><span style="color:#111">(</span><span style="color:#d88200">&#34;http://golang.org&#34;</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">resp</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">defer</span> <span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">StatusCode</span><span style="color:#111">)</span>

    <span style="color:#75af00">body</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">ioutil</span><span style="color:#111">.</span><span style="color:#75af00">ReadAll</span><span style="color:#111">(</span><span style="color:#75af00">resp</span><span style="color:#111">.</span><span style="color:#75af00">Body</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">body</span><span style="color:#111">)))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you send a lot of requests to the same HTTP server it&rsquo;s ok to keep the network connection open. However, if your app sends one or two requests to many different HTTP servers in a short period of time it&rsquo;s a good idea to close the network connections right after your app receives the responses. Increasing the open file limit might be a good idea too. The correct solution depends on your application though.</p>
<h2 id="json-encoder-adds-a-newline-character">JSON Encoder Adds a Newline Character</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>You are writing a test for your JSON encoding function when you discover that your tests fail because you are not getting the expected value. What happened? If you are using the JSON Encoder object then you&rsquo;ll get an extra newline character at the end of your encoded JSON object.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;bytes&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#d88200">&#34;key&#34;</span><span style="color:#111">:</span> <span style="color:#ae81ff">1</span><span style="color:#111">}</span>
  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">b</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">Buffer</span>
  <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewEncoder</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">b</span><span style="color:#111">).</span><span style="color:#75af00">Encode</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span>

  <span style="color:#75af00">raw</span><span style="color:#111">,</span><span style="color:#75af00">_</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Marshal</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
  
  <span style="color:#00a8c8">if</span> <span style="color:#75af00">b</span><span style="color:#111">.</span><span style="color:#75af00">String</span><span style="color:#111">()</span> <span style="color:#f92672">==</span> <span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;same encoded data&#34;</span><span style="color:#111">)</span>
  <span style="color:#111">}</span> <span style="color:#00a8c8">else</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;&#39;%s&#39; != &#39;%s&#39;\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">raw</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">.</span><span style="color:#75af00">String</span><span style="color:#111">())</span>
    <span style="color:#75715e">//prints:
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//&#39;{&#34;key&#34;:1}&#39; != &#39;{&#34;key&#34;:1}\n&#39;
</span><span style="color:#75715e"></span>  <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The JSON Encoder object is designed for streaming. Streaming with JSON usually means newline delimited JSON objects and this is why the Encode method adds a newline character. This is a documented behavior, but it&rsquo;s commonly overlooked or forgotten.</p>
<h2 id="json-package-escapes-special-html-characters-in-keys-and-string-values">JSON Package Escapes Special HTML Characters in Keys and String Values</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>This is a documented behavior, but you have to be careful reading all of the JSON package documentation to learn about it. The <code>SetEscapeHTML</code> method description talks about the default encoding behavior for the and, less than and greater than characters.</p>
<p>This is a very unfortunate design decision by the Go team for a number of reasons. First, you can&rsquo;t disable this behavior for the <code>json.Marshal</code> calls. Second, this is a badly implemented security feature because it assumes that doing HTML encoding is sufficient to protect against XSS vulnerabilities in all web applications. There are a lot of different contexts where the data can be used and each context requires its own encoding method. And finally, it&rsquo;s bad because it assumes that the primary use case for JSON is a web page, which breaks the configuration libraries and the REST/HTTP APIs by default.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;bytes&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#d88200">&#34;x &lt; y&#34;</span>
  
  <span style="color:#75af00">raw</span><span style="color:#111">,</span><span style="color:#75af00">_</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Marshal</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">))</span>
  <span style="color:#75715e">//prints: &#34;x \u003c y&#34; &lt;- probably not what you expected
</span><span style="color:#75715e"></span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">b1</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">Buffer</span>
  <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewEncoder</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">b1</span><span style="color:#111">).</span><span style="color:#75af00">Encode</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">b1</span><span style="color:#111">.</span><span style="color:#75af00">String</span><span style="color:#111">())</span>
  <span style="color:#75715e">//prints: &#34;x \u003c y&#34; &lt;- probably not what you expected
</span><span style="color:#75715e"></span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">b2</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">Buffer</span>
  <span style="color:#75af00">enc</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewEncoder</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">b2</span><span style="color:#111">)</span>
  <span style="color:#75af00">enc</span><span style="color:#111">.</span><span style="color:#75af00">SetEscapeHTML</span><span style="color:#111">(</span><span style="color:#00a8c8">false</span><span style="color:#111">)</span>
  <span style="color:#75af00">enc</span><span style="color:#111">.</span><span style="color:#75af00">Encode</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">b2</span><span style="color:#111">.</span><span style="color:#75af00">String</span><span style="color:#111">())</span>
  <span style="color:#75715e">//prints: &#34;x &lt; y&#34; &lt;- looks better
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>A suggestion to the Go team&hellip; Make it an opt-in.</p>
<h2 id="unmarshalling-json-numbers-into-interface-values">Unmarshalling JSON Numbers into Interface Values</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>By default, Go treats numeric values in JSON as <code>float64</code> numbers when you decode/unmarshal JSON data into an interface. This means the following code will fail with a panic:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#111">=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;: 200}`</span><span style="color:#111">)</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>
  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">result</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">status</span> <span style="color:#111">=</span> <span style="color:#75af00">result</span><span style="color:#111">[</span><span style="color:#d88200">&#34;status&#34;</span><span style="color:#111">].(</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;status value:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">status</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Runtime Panic:</p>
<blockquote>
<p>panic: interface conversion: interface is float64, not int</p>
</blockquote>
<p>If the JSON value you are trying to decode is an integer you have serveral options.</p>
<p>Option one: use the float value as-is :-)</p>
<p>Option two: convert the float value to the integer type you need.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#111">=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;: 200}`</span><span style="color:#111">)</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>
  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">result</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">status</span> <span style="color:#111">=</span> <span style="color:#111">uint64</span><span style="color:#111">(</span><span style="color:#75af00">result</span><span style="color:#111">[</span><span style="color:#d88200">&#34;status&#34;</span><span style="color:#111">].(</span><span style="color:#00a8c8">float64</span><span style="color:#111">))</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;status value:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">status</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Option three: use a <code>Decoder</code> type to unmarshal JSON and tell it to represent JSON numbers using the <code>Number</code> interface type.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;bytes&#34;</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#111">=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;: 200}`</span><span style="color:#111">)</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">decoder</span> <span style="color:#111">=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewDecoder</span><span style="color:#111">(</span><span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">NewReader</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">))</span>
  <span style="color:#75af00">decoder</span><span style="color:#111">.</span><span style="color:#75af00">UseNumber</span><span style="color:#111">()</span>

  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">decoder</span><span style="color:#111">.</span><span style="color:#75af00">Decode</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">result</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">status</span><span style="color:#111">,</span><span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">result</span><span style="color:#111">[</span><span style="color:#d88200">&#34;status&#34;</span><span style="color:#111">].(</span><span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Number</span><span style="color:#111">).</span><span style="color:#75af00">Int64</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;status value:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">status</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can use the string representation of your <code>Number</code> value to unmarshal it to a different numeric type:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;bytes&#34;</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#111">=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;: 200}`</span><span style="color:#111">)</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">decoder</span> <span style="color:#111">=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewDecoder</span><span style="color:#111">(</span><span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">NewReader</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">))</span>
  <span style="color:#75af00">decoder</span><span style="color:#111">.</span><span style="color:#75af00">UseNumber</span><span style="color:#111">()</span>

  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">decoder</span><span style="color:#111">.</span><span style="color:#75af00">Decode</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">result</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">status</span> <span style="color:#00a8c8">uint64</span>
  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">([]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#75af00">result</span><span style="color:#111">[</span><span style="color:#d88200">&#34;status&#34;</span><span style="color:#111">].(</span><span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Number</span><span style="color:#111">).</span><span style="color:#75af00">String</span><span style="color:#111">()),</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">status</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;status value:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">status</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Option four: use a <code>struct</code> type that maps your numeric value to the numeric type you need.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;bytes&#34;</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#111">=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;: 200}`</span><span style="color:#111">)</span>

  <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>
    <span style="color:#75af00">Status</span> <span style="color:#00a8c8">uint64</span> <span style="color:#d88200">`json:&#34;status&#34;`</span>
  <span style="color:#111">}</span>

  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewDecoder</span><span style="color:#111">(</span><span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">NewReader</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)).</span><span style="color:#75af00">Decode</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">result</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">return</span>
  <span style="color:#111">}</span>

  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;result =&gt; %+v&#34;</span><span style="color:#111">,</span><span style="color:#75af00">result</span><span style="color:#111">)</span>
  <span style="color:#75715e">//prints: result =&gt; {Status:200}
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Option five: use a <code>struct</code> that maps your numeric value to the <code>json.RawMessage</code> type if you need to defer the value decoding.</p>
<p>This option is useful if you have to perform conditional JSON field decoding where the field type or structure might change.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
  <span style="color:#d88200">&#34;bytes&#34;</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
  <span style="color:#75af00">records</span> <span style="color:#f92672">:=</span> <span style="color:#111">[][]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{</span>
    <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;: 200, &#34;tag&#34;:&#34;one&#34;}`</span><span style="color:#111">),</span>
    <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;status&#34;:&#34;ok&#34;, &#34;tag&#34;:&#34;two&#34;}`</span><span style="color:#111">),</span>
  <span style="color:#111">}</span>

  <span style="color:#00a8c8">for</span> <span style="color:#75af00">idx</span><span style="color:#111">,</span> <span style="color:#75af00">record</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">records</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>
      <span style="color:#75af00">StatusCode</span> <span style="color:#00a8c8">uint64</span>
      <span style="color:#75af00">StatusName</span> <span style="color:#00a8c8">string</span>
      <span style="color:#75af00">Status</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">RawMessage</span> <span style="color:#d88200">`json:&#34;status&#34;`</span>
      <span style="color:#75af00">Tag</span> <span style="color:#00a8c8">string</span>             <span style="color:#d88200">`json:&#34;tag&#34;`</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">NewDecoder</span><span style="color:#111">(</span><span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">NewReader</span><span style="color:#111">(</span><span style="color:#75af00">record</span><span style="color:#111">)).</span><span style="color:#75af00">Decode</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">result</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
      <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span> <span style="color:#75af00">err</span><span style="color:#111">)</span>
      <span style="color:#00a8c8">return</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">var</span> <span style="color:#75af00">sstatus</span> <span style="color:#00a8c8">string</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">result</span><span style="color:#111">.</span><span style="color:#75af00">Status</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">sstatus</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
      <span style="color:#75af00">result</span><span style="color:#111">.</span><span style="color:#75af00">StatusName</span> <span style="color:#111">=</span> <span style="color:#75af00">sstatus</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">var</span> <span style="color:#75af00">nstatus</span> <span style="color:#00a8c8">uint64</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">result</span><span style="color:#111">.</span><span style="color:#75af00">Status</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">nstatus</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
      <span style="color:#75af00">result</span><span style="color:#111">.</span><span style="color:#75af00">StatusCode</span> <span style="color:#111">=</span> <span style="color:#75af00">nstatus</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[%v] result =&gt; %+v\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">idx</span><span style="color:#111">,</span><span style="color:#75af00">result</span><span style="color:#111">)</span>
  <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="json-string-values-will-not-be-ok-with-hex-or-other-non-utf8-escape-sequences">JSON String Values Will Not Be Ok with Hex or Other non-UTF8 Escape Sequences</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Go expects string values to be UTF8 encoded. This means you can&rsquo;t have arbitrary hex escaped binary data in your JSON strings (and you also have to escape the backslash character). This is really a JSON gotcha Go inherited, but it happens often enough in Go apps that it makes sense to mention it anyways.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">config</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>
  <span style="color:#75af00">Data</span> <span style="color:#00a8c8">string</span> <span style="color:#d88200">`json:&#34;data&#34;`</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">raw</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;data&#34;:&#34;\xc2&#34;}`</span><span style="color:#111">)</span>
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">decoded</span> <span style="color:#75af00">config</span>

  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">decoded</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints: invalid character &#39;x&#39; in string escape code
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
  
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The Unmarshal/Decode calls will fail if Go sees a hex escape sequence. If you do need to have a backslash in you string make sure to escape it with another backlash. If you want to use hex encoded binary data you can escape the backslash and then do your own hex escaping with the decoded data in your JSON string.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">config</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>
  <span style="color:#75af00">Data</span> <span style="color:#00a8c8">string</span> <span style="color:#d88200">`json:&#34;data&#34;`</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">raw</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;data&#34;:&#34;\\xc2&#34;}`</span><span style="color:#111">)</span>
  
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">decoded</span> <span style="color:#75af00">config</span>
  
  <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">decoded</span><span style="color:#111">)</span>
  
  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%#v&#34;</span><span style="color:#111">,</span><span style="color:#75af00">decoded</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: main.config{Data:&#34;\\xc2&#34;}
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//todo: do your own hex escape decoding for decoded.Data  
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Another option is to use the byte array/slice data type in your JSON object, but the binary data will have to be base64 encoded.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
  <span style="color:#d88200">&#34;encoding/json&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">config</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>
  <span style="color:#75af00">Data</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span> <span style="color:#d88200">`json:&#34;data&#34;`</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">raw</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">`{&#34;data&#34;:&#34;wg==&#34;}`</span><span style="color:#111">)</span>
  <span style="color:#00a8c8">var</span> <span style="color:#75af00">decoded</span> <span style="color:#75af00">config</span>
  
  <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">decoded</span><span style="color:#111">);</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
          <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
      <span style="color:#111">}</span>
  
  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%#v&#34;</span><span style="color:#111">,</span><span style="color:#75af00">decoded</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: main.config{Data:[]uint8{0xc2}}
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Something else to watch out for is the Unicode replacement character (U+FFFD). Go will use the replacement character instead of invalid UTF8, so the Unmarshal/Decode call will not fail, but the string value you get might not be what you expected.</p>
<h2 id="comparing-structs-arrays-slices-and-maps">Comparing Structs, Arrays, Slices, and Maps</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>You can use the equality operator, <code>==</code>, to compare struct variables if each structure field can be compared with the equality operator.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">num</span> <span style="color:#00a8c8">int</span>
    <span style="color:#75af00">fp</span> <span style="color:#00a8c8">float32</span>
    <span style="color:#75af00">complex</span> <span style="color:#00a8c8">complex64</span>
    <span style="color:#75af00">str</span> <span style="color:#00a8c8">string</span>
    <span style="color:#75af00">char</span> <span style="color:#00a8c8">rune</span>
    <span style="color:#75af00">yes</span> <span style="color:#00a8c8">bool</span>
    <span style="color:#75af00">events</span> <span style="color:#f92672">&lt;-</span><span style="color:#00a8c8">chan</span> <span style="color:#00a8c8">string</span>
    <span style="color:#75af00">handler</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>
    <span style="color:#75af00">ref</span> <span style="color:#f92672">*</span><span style="color:#00a8c8">byte</span>
    <span style="color:#75af00">raw</span> <span style="color:#111">[</span><span style="color:#ae81ff">10</span><span style="color:#111">]</span><span style="color:#00a8c8">byte</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">v1</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{}</span>
    <span style="color:#75af00">v2</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;v1 == v2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">v1</span> <span style="color:#f92672">==</span> <span style="color:#75af00">v2</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: v1 == v2: true
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If any of the struct fields are not comparable then using the equality operator will result in compile time errors. Note that arrays are comparable only if their data items are comparable.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">num</span> <span style="color:#00a8c8">int</span>                <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>    <span style="color:#75af00">checks</span> <span style="color:#111">[</span><span style="color:#ae81ff">10</span><span style="color:#111">]</span><span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#00a8c8">bool</span> <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">doit</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#00a8c8">bool</span>       <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">m</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span> <span style="color:#00a8c8">string</span>   <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">bytes</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span>           <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span><span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">v1</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{}</span>
    <span style="color:#75af00">v2</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;v1 == v2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">v1</span> <span style="color:#f92672">==</span> <span style="color:#75af00">v2</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Go does provide a number of helper functions to compare variables that can&rsquo;t be compared using the comparison operators.</p>
<p>The most generic solution is to use the <code>DeepEqual()</code> function in the reflect package.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;reflect&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">num</span> <span style="color:#00a8c8">int</span>                <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>    <span style="color:#75af00">checks</span> <span style="color:#111">[</span><span style="color:#ae81ff">10</span><span style="color:#111">]</span><span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#00a8c8">bool</span> <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">doit</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#00a8c8">bool</span>       <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">m</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span> <span style="color:#00a8c8">string</span>   <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span>    <span style="color:#75af00">bytes</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span>           <span style="color:#75715e">//not comparable
</span><span style="color:#75715e"></span><span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">v1</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{}</span>
    <span style="color:#75af00">v2</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;v1 == v2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">v1</span><span style="color:#111">,</span><span style="color:#75af00">v2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: v1 == v2: true
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">m1</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;a&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;b&#34;</span><span style="color:#111">}</span>
    <span style="color:#75af00">m2</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;b&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;a&#34;</span><span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;m1 == m2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">m1</span><span style="color:#111">,</span> <span style="color:#75af00">m2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: m1 == m2: true
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">s1</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#ae81ff">3</span><span style="color:#111">}</span>
    <span style="color:#75af00">s2</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#ae81ff">3</span><span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;s1 == s2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">s1</span><span style="color:#111">,</span> <span style="color:#75af00">s2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: s1 == s2: true
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Aside from being slow (which may or may not be a deal breaker for your application), <code>DeepEqual()</code> also has its own gotchas.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;reflect&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">b1</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>
    <span style="color:#75af00">b2</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;b1 == b2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">b1</span><span style="color:#111">,</span> <span style="color:#75af00">b2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: b1 == b2: false
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>DeepEqual()</code> doesn&rsquo;t consider an empty slice to be equal to a &ldquo;nil&rdquo; slice. This behavior is different from the behavior you get using the <code>bytes.Equal()</code> function. <code>bytes.Equal()</code> considers &ldquo;nil&rdquo; and empty slices to be equal.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;bytes&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">b1</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>
    <span style="color:#75af00">b2</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;b1 == b2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">Equal</span><span style="color:#111">(</span><span style="color:#75af00">b1</span><span style="color:#111">,</span> <span style="color:#75af00">b2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: b1 == b2: true
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>DeepEqual()</code> isn&rsquo;t always perfect comparing slices.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;reflect&#34;</span>
    <span style="color:#d88200">&#34;encoding/json&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">str</span> <span style="color:#00a8c8">string</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;one&#34;</span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">in</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;one&#34;</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;str == in:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">str</span> <span style="color:#f92672">==</span> <span style="color:#75af00">in</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">str</span><span style="color:#111">,</span> <span style="color:#75af00">in</span><span style="color:#111">))</span> 
    <span style="color:#75715e">//prints: str == in: true true
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">v1</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">}</span>
    <span style="color:#75af00">v2</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;v1 == v2:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">v1</span><span style="color:#111">,</span> <span style="color:#75af00">v2</span><span style="color:#111">))</span> 
    <span style="color:#75715e">//prints: v1 == v2: false (not ok)
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}{</span>
        <span style="color:#d88200">&#34;code&#34;</span><span style="color:#111">:</span> <span style="color:#ae81ff">200</span><span style="color:#111">,</span>
        <span style="color:#d88200">&#34;value&#34;</span><span style="color:#111">:</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">},</span>
    <span style="color:#111">}</span>
    <span style="color:#75af00">encoded</span><span style="color:#111">,</span> <span style="color:#75af00">_</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Marshal</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">decoded</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>
    <span style="color:#75af00">json</span><span style="color:#111">.</span><span style="color:#75af00">Unmarshal</span><span style="color:#111">(</span><span style="color:#75af00">encoded</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">decoded</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;data == decoded:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">reflect</span><span style="color:#111">.</span><span style="color:#75af00">DeepEqual</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">,</span> <span style="color:#75af00">decoded</span><span style="color:#111">))</span> 
    <span style="color:#75715e">//prints: data == decoded: false (not ok)
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If your byte slices (or strings) contain text data you might be tempted to use <code>ToUpper()</code> or <code>ToLower()</code> from the &ldquo;bytes&rdquo; and &ldquo;strings&rdquo; packages when you need to compare values in a case insensitive manner (before using <code>==</code>,<code>bytes.Equal()</code>, or <code>bytes.Compare()</code>). It will work for English text, but it will not work for text in many other languages. <code>strings.EqualFold()</code> and <code>bytes.EqualFold()</code> should be used instead.</p>
<p>If your byte slices contain secrets (e.g., cryptographic hashes, tokens, etc.) that need to be validated against user-provided data, don&rsquo;t use <code>reflect.DeepEqual()</code>, <code>bytes.Equal()</code>, or <code>bytes.Compare()</code> because those functions will make your application vulnerable to <a href="http://en.wikipedia.org/wiki/Timing_attack"><strong>timing attacks</strong></a>. To avoid leaking the timing information use the functions from the &lsquo;crypto/subtle&rsquo; package (e.g., <code>subtle.ConstantTimeCompare()</code>).</p>
<h2 id="recovering-from-a-panic">Recovering From a Panic</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>The <code>recover()</code> function can be used to catch/intercept a panic. Calling <code>recover()</code> will do the trick only when it&rsquo;s done in a deferred function.</p>
<p>Incorrect:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#111">recover</span><span style="color:#111">()</span> <span style="color:#75715e">//doesn&#39;t do anything
</span><span style="color:#75715e"></span>    <span style="color:#111">panic</span><span style="color:#111">(</span><span style="color:#d88200">&#34;not good&#34;</span><span style="color:#111">)</span>
    <span style="color:#111">recover</span><span style="color:#111">()</span> <span style="color:#75715e">//won&#39;t be executed :)
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;ok&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">defer</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;recovered:&#34;</span><span style="color:#111">,</span><span style="color:#111">recover</span><span style="color:#111">())</span>
    <span style="color:#111">}()</span>

    <span style="color:#111">panic</span><span style="color:#111">(</span><span style="color:#d88200">&#34;not good&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The call to <code>recover()</code> works only if it&rsquo;s called directly in your deferred function.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">doRecover</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;recovered =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">recover</span><span style="color:#111">())</span> <span style="color:#75715e">//prints: recovered =&gt; &lt;nil&gt;
</span><span style="color:#75715e"></span><span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">defer</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
        <span style="color:#75af00">doRecover</span><span style="color:#111">()</span> <span style="color:#75715e">//panic is not recovered
</span><span style="color:#75715e"></span>    <span style="color:#111">}()</span>

    <span style="color:#111">panic</span><span style="color:#111">(</span><span style="color:#d88200">&#34;not good&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="updating-and-referencing-item-values-in-slice-array-and-map-range-clauses">Updating and Referencing Item Values in Slice, Array, and Map &ldquo;range&rdquo; Clauses</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>The data values generated in the &ldquo;range&rdquo; clause are copies of the actual collection elements. They are not references to the original items. This means that updating the values will not change the original data. It also means that taking the address of the values will not give you pointers to the original data.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#75af00">v</span> <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span> <span style="color:#75715e">//original item is not changed
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;data:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#75715e">//prints data: [1 2 3]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you need to update the original collection record value use the index operator to access the data.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">int</span><span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">}</span>
    <span style="color:#00a8c8">for</span> <span style="color:#75af00">i</span><span style="color:#111">,</span><span style="color:#75af00">_</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#75af00">i</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;data:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#75715e">//prints data: [10 20 30]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If your collection holds pointer values then the rules are slightly different. You still need to use the index operator if you want the original record to point to another value, but you can update the data stored at the target location using the second value in the &ldquo;for range&rdquo; clause.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#f92672">*</span><span style="color:#00a8c8">struct</span><span style="color:#111">{</span><span style="color:#75af00">num</span> <span style="color:#00a8c8">int</span><span style="color:#111">}</span> <span style="color:#111">{{</span><span style="color:#ae81ff">1</span><span style="color:#111">},{</span><span style="color:#ae81ff">2</span><span style="color:#111">},{</span><span style="color:#ae81ff">3</span><span style="color:#111">}}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#75af00">v</span><span style="color:#111">.</span><span style="color:#75af00">num</span> <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#ae81ff">2</span><span style="color:#111">])</span> <span style="color:#75715e">//prints &amp;{10} &amp;{20} &amp;{30}
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="hidden-data-in-slices">&ldquo;Hidden&rdquo; Data in Slices</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>When you reslice a slice, the new slice will reference the array of the original slice. If you forget about this behavior it can lead to unexpected memory usage if your application allocates large temporary slices creating new slices from them to refer to small sections of the original data.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">get</span><span style="color:#111">()</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">raw</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">([]</span><span style="color:#00a8c8">byte</span><span style="color:#111">,</span><span style="color:#ae81ff">10000</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">),</span><span style="color:#111">cap</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">),</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">raw</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span> <span style="color:#75715e">//prints: 10000 10000 &lt;byte_addr_x&gt;
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">return</span> <span style="color:#75af00">raw</span><span style="color:#111">[:</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">get</span><span style="color:#111">()</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">),</span><span style="color:#111">cap</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">),</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span> <span style="color:#75715e">//prints: 3 10000 &lt;byte_addr_x&gt;
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>To avoid this trap make sure to copy the data you need from the temporary slice (instead of reslicing it).</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">get</span><span style="color:#111">()</span> <span style="color:#111">[]</span><span style="color:#00a8c8">byte</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">raw</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">([]</span><span style="color:#00a8c8">byte</span><span style="color:#111">,</span><span style="color:#ae81ff">10000</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">),</span><span style="color:#111">cap</span><span style="color:#111">(</span><span style="color:#75af00">raw</span><span style="color:#111">),</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">raw</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span> <span style="color:#75715e">//prints: 10000 10000 &lt;byte_addr_x&gt;
</span><span style="color:#75715e"></span>    <span style="color:#75af00">res</span> <span style="color:#f92672">:=</span> <span style="color:#111">make</span><span style="color:#111">([]</span><span style="color:#00a8c8">byte</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">)</span>
    <span style="color:#111">copy</span><span style="color:#111">(</span><span style="color:#75af00">res</span><span style="color:#111">,</span><span style="color:#75af00">raw</span><span style="color:#111">[:</span><span style="color:#ae81ff">3</span><span style="color:#111">])</span>
    <span style="color:#00a8c8">return</span> <span style="color:#75af00">res</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">get</span><span style="color:#111">()</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">),</span><span style="color:#111">cap</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">),</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">data</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">])</span> <span style="color:#75715e">//prints: 3 3 &lt;byte_addr_y&gt;
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="slice-data-corruption">Slice Data &ldquo;Corruption&rdquo;</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Let&rsquo;s say you need to rewrite a path (stored in a slice). You reslice the path to reference each directory modifying the first folder name and then you combine the names to create a new path.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;bytes&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">path</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">&#34;AAAA/BBBBBBBBB&#34;</span><span style="color:#111">)</span>
    <span style="color:#75af00">sepIndex</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">IndexByte</span><span style="color:#111">(</span><span style="color:#75af00">path</span><span style="color:#111">,</span><span style="color:#d88200">&#39;/&#39;</span><span style="color:#111">)</span>
    <span style="color:#75af00">dir1</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">path</span><span style="color:#111">[:</span><span style="color:#75af00">sepIndex</span><span style="color:#111">]</span>
    <span style="color:#75af00">dir2</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">path</span><span style="color:#111">[</span><span style="color:#75af00">sepIndex</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#111">:]</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir1 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir1 =&gt; AAAA
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir2 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir2 =&gt; BBBBBBBBB
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">dir1</span> <span style="color:#111">=</span> <span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#75af00">dir1</span><span style="color:#111">,</span><span style="color:#d88200">&#34;suffix&#34;</span><span style="color:#f92672">...</span><span style="color:#111">)</span>
    <span style="color:#75af00">path</span> <span style="color:#111">=</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">Join</span><span style="color:#111">([][]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{</span><span style="color:#75af00">dir1</span><span style="color:#111">,</span><span style="color:#75af00">dir2</span><span style="color:#111">},[]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{</span><span style="color:#d88200">&#39;/&#39;</span><span style="color:#111">})</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir1 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir1 =&gt; AAAAsuffix
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir2 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir2 =&gt; uffixBBBB (not ok)
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;new path =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">path</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>It didn&rsquo;t work as you expected. Instead of &ldquo;AAAAsuffix/BBBBBBBBB&rdquo; you ended up with &ldquo;AAAAsuffix/uffixBBBB&rdquo;. It happened because both directory slices referenced the same underlying array data from the original path slice. This means that the original path is also modified. Depending on your application this might be a problem too.</p>
<p>This problem can fixed by allocating new slices and copying the data you need. Another option is to use the full slice expression.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;bytes&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">path</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#111">byte</span><span style="color:#111">(</span><span style="color:#d88200">&#34;AAAA/BBBBBBBBB&#34;</span><span style="color:#111">)</span>
    <span style="color:#75af00">sepIndex</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">IndexByte</span><span style="color:#111">(</span><span style="color:#75af00">path</span><span style="color:#111">,</span><span style="color:#d88200">&#39;/&#39;</span><span style="color:#111">)</span>
    <span style="color:#75af00">dir1</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">path</span><span style="color:#111">[:</span><span style="color:#75af00">sepIndex</span><span style="color:#111">:</span><span style="color:#75af00">sepIndex</span><span style="color:#111">]</span> <span style="color:#75715e">//full slice expression
</span><span style="color:#75715e"></span>    <span style="color:#75af00">dir2</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">path</span><span style="color:#111">[</span><span style="color:#75af00">sepIndex</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#111">:]</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir1 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir1 =&gt; AAAA
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir2 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir2 =&gt; BBBBBBBBB
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">dir1</span> <span style="color:#111">=</span> <span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#75af00">dir1</span><span style="color:#111">,</span><span style="color:#d88200">&#34;suffix&#34;</span><span style="color:#f92672">...</span><span style="color:#111">)</span>
    <span style="color:#75af00">path</span> <span style="color:#111">=</span> <span style="color:#75af00">bytes</span><span style="color:#111">.</span><span style="color:#75af00">Join</span><span style="color:#111">([][]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{</span><span style="color:#75af00">dir1</span><span style="color:#111">,</span><span style="color:#75af00">dir2</span><span style="color:#111">},[]</span><span style="color:#00a8c8">byte</span><span style="color:#111">{</span><span style="color:#d88200">&#39;/&#39;</span><span style="color:#111">})</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir1 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir1 =&gt; AAAAsuffix
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;dir2 =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">dir2</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: dir2 =&gt; BBBBBBBBB (ok now)
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;new path =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#111">string</span><span style="color:#111">(</span><span style="color:#75af00">path</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The extra parameter in the full slice expression controls the capacity for the new slice. Now appending to that slice will trigger a new buffer allocation instead of overwriting the data in the second slice.</p>
<h2 id="stale-slices">&ldquo;Stale&rdquo; Slices</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Multiple slices can reference the same data. This can happen when you create a new slice from an existing slice, for example. If your application relies on this behavior to function properly then you&rsquo;ll need to worry about &ldquo;stale&rdquo; slices.</p>
<p>At some point adding data to one of the slices will result in a new array allocation when the original array can&rsquo;t hold any more new data. Now other slices will point to the old array (with old data).</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">import &#34;fmt&#34;

func main() {  
    s1 := []int{1,2,3}
    fmt.Println(len(s1),cap(s1),s1) //prints 3 3 [1 2 3]

    s2 := s1[1:]
    fmt.Println(len(s2),cap(s2),s2) //prints 2 2 [2 3]

    for i := range s2 { s2[i] += 20 }

    //still referencing the same array
    fmt.Println(s1) //prints [1 22 23]
    fmt.Println(s2) //prints [22 23]

    s2 = append(s2,4)

    for i := range s2 { s2[i] += 10 }

    //s1 is now &#34;stale&#34;
    fmt.Println(s1) //prints [1 22 23]
    fmt.Println(s2) //prints [32 33 14]
}
</code></pre></td></tr></table>
</div>
</div><h2 id="type-declarations-and-methods">Type Declarations and Methods</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>When you create a type declaration by defining a new type from an existing (non-interface) type, you don&rsquo;t inherit the methods defined for that existing type.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;sync&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">myMutex</span> <span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">Mutex</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">mtx</span> <span style="color:#75af00">myMutex</span>
    <span style="color:#75af00">mtx</span><span style="color:#111">.</span><span style="color:#75af00">Lock</span><span style="color:#111">()</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>    <span style="color:#75af00">mtx</span><span style="color:#111">.</span><span style="color:#75af00">Unlock</span><span style="color:#111">()</span> <span style="color:#75715e">//error  
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox106401185/main.go:9: mtx.Lock undefined (type myMutex has no field or method Lock) /tmp/sandbox106401185/main.go:10: mtx.Unlock undefined (type myMutex has no field or method Unlock)</p>
</blockquote>
<p>If you do need the methods from the original type you can define a new struct type embedding the original type as an anonymous field.</p>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;sync&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">myLocker</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">Mutex</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">lock</span> <span style="color:#75af00">myLocker</span>
    <span style="color:#75af00">lock</span><span style="color:#111">.</span><span style="color:#75af00">Lock</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>    <span style="color:#75af00">lock</span><span style="color:#111">.</span><span style="color:#75af00">Unlock</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Interface type declarations also retain their method sets.</p>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;sync&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">myLocker</span> <span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">Locker</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">lock</span> <span style="color:#75af00">myLocker</span> <span style="color:#111">=</span> <span style="color:#111">new</span><span style="color:#111">(</span><span style="color:#75af00">sync</span><span style="color:#111">.</span><span style="color:#75af00">Mutex</span><span style="color:#111">)</span>
    <span style="color:#75af00">lock</span><span style="color:#111">.</span><span style="color:#75af00">Lock</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>    <span style="color:#75af00">lock</span><span style="color:#111">.</span><span style="color:#75af00">Unlock</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="breaking-out-of-for-switch-and-for-select-code-blocks">Breaking Out of &ldquo;for switch&rdquo; and &ldquo;for select&rdquo; Code Blocks</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>A &ldquo;break&rdquo; statement without a label only gets you out of the inner switch/select block. If using a &ldquo;return&rdquo; statement is not an option then defining a label for the outer loop is the next best thing.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">loop</span><span style="color:#111">:</span>
        <span style="color:#00a8c8">for</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">switch</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">case</span> <span style="color:#00a8c8">true</span><span style="color:#111">:</span>
                <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;breaking out...&#34;</span><span style="color:#111">)</span>
                <span style="color:#00a8c8">break</span> <span style="color:#75af00">loop</span>
            <span style="color:#111">}</span>
        <span style="color:#111">}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;out!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>A &ldquo;goto&rdquo; statement will do the trick too&hellip;</p>
<h2 id="iteration-variables-and-closures-in-for-statements">Iteration Variables and Closures in &ldquo;for&rdquo; Statements</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>This is the most common gotcha in Go. The iteration variables in <code>for</code> statements are reused in each iteration. This means that each closure (aka function literal) created in your <code>for</code> loop will reference the same variable (and they&rsquo;ll get that variable&rsquo;s value at the time those goroutines start executing).</p>
<p>Incorrect:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">v</span><span style="color:#111">)</span>
        <span style="color:#111">}()</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75715e">//goroutines print: three, three, three
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The easiest solution (that doesn&rsquo;t require any changes to the goroutine) is to save the current iteration variable value in a local variable inside the <code>for</code> loop block.</p>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#75af00">vcopy</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">v</span> <span style="color:#75715e">//
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">vcopy</span><span style="color:#111">)</span>
        <span style="color:#111">}()</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75715e">//goroutines print: one, two, three
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Another solution is to pass the current iteration variable as a parameter to the anonymous goroutine.</p>
<p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">in</span> <span style="color:#00a8c8">string</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">in</span><span style="color:#111">)</span>
        <span style="color:#111">}(</span><span style="color:#75af00">v</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75715e">//goroutines print: one, two, three
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Here&rsquo;s a slightly more complicated version of the trap.</p>
<p>Incorrect:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">field</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">p</span> <span style="color:#f92672">*</span><span style="color:#75af00">field</span><span style="color:#111">)</span> <span style="color:#111">print</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">p</span><span style="color:#111">.</span><span style="color:#75af00">name</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#75af00">field</span><span style="color:#111">{{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">},{</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">},{</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#75af00">v</span><span style="color:#111">.</span><span style="color:#111">print</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75715e">//goroutines print: three, three, three
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">field</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">p</span> <span style="color:#f92672">*</span><span style="color:#75af00">field</span><span style="color:#111">)</span> <span style="color:#111">print</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">p</span><span style="color:#111">.</span><span style="color:#75af00">name</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#75af00">field</span><span style="color:#111">{{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">},{</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">},{</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">v</span>
        <span style="color:#00a8c8">go</span> <span style="color:#75af00">v</span><span style="color:#111">.</span><span style="color:#111">print</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
    <span style="color:#75715e">//goroutines print: one, two, three
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>What do you think you&rsquo;ll see when you run this code (and why)?</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">field</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">p</span> <span style="color:#f92672">*</span><span style="color:#75af00">field</span><span style="color:#111">)</span> <span style="color:#111">print</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">p</span><span style="color:#111">.</span><span style="color:#75af00">name</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">data</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#f92672">*</span><span style="color:#75af00">field</span><span style="color:#111">{{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">},{</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">},{</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}}</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">v</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">data</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">go</span> <span style="color:#75af00">v</span><span style="color:#111">.</span><span style="color:#111">print</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="deferred-function-call-argument-evaluation">Deferred Function Call Argument Evaluation</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Arguments for a deferred function call are evaluated when the <code>defer</code> statement is evaluated (not when the function is actually executing). The same rules apply when you defer a method call. The structure value is also saved along with the explicit method parameters and the closed variables.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">i</span> <span style="color:#00a8c8">int</span> <span style="color:#111">=</span> <span style="color:#ae81ff">1</span>

    <span style="color:#00a8c8">defer</span> <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;result =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#00a8c8">int</span> <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#75af00">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#111">}())</span>
    <span style="color:#75af00">i</span><span style="color:#f92672">++</span>
    <span style="color:#75715e">//prints: result =&gt; 2 (not ok if you expected 4)
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you have pointer parameters it is possible to change the values they point to because only the pointer is saved when the <code>defer</code> statement is evaluated.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
  <span style="color:#00a8c8">defer</span> <span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">in</span> <span style="color:#f92672">*</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#111">{</span> <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;result =&gt;&#34;</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#75af00">in</span><span style="color:#111">)</span> <span style="color:#111">}(</span><span style="color:#f92672">&amp;</span><span style="color:#75af00">i</span><span style="color:#111">)</span>
  
  <span style="color:#75af00">i</span> <span style="color:#111">=</span> <span style="color:#ae81ff">2</span>
  <span style="color:#75715e">//prints: result =&gt; 2
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="deferred-function-call-execution">Deferred Function Call Execution</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>The deferred calls are executed at the end of the containing function (and in reverse order) and not at the end of the containing code block. It&rsquo;s an easy mistake to make for new Go developers confusing the deferred code execution rules with the variable scoping rules. It can become a problem if you have a long running function with a <code>for</code> loop that tries to <code>defer</code> resource cleanup calls in each iteration.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;os&#34;</span>
    <span style="color:#d88200">&#34;path/filepath&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">if</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Args</span><span style="color:#111">)</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> <span style="color:#111">{</span>
        <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Exit</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">start</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Stat</span><span style="color:#111">(</span><span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Args</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">])</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#f92672">||</span> <span style="color:#111">!</span><span style="color:#75af00">start</span><span style="color:#111">.</span><span style="color:#75af00">IsDir</span><span style="color:#111">(){</span>
        <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Exit</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">var</span> <span style="color:#75af00">targets</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span>
    <span style="color:#75af00">filepath</span><span style="color:#111">.</span><span style="color:#75af00">Walk</span><span style="color:#111">(</span><span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Args</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">fpath</span> <span style="color:#00a8c8">string</span><span style="color:#111">,</span> <span style="color:#75af00">fi</span> <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">FileInfo</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#00a8c8">error</span><span style="color:#111">)</span> <span style="color:#00a8c8">error</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">return</span> <span style="color:#75af00">err</span>
        <span style="color:#111">}</span>

        <span style="color:#00a8c8">if</span> <span style="color:#111">!</span><span style="color:#75af00">fi</span><span style="color:#111">.</span><span style="color:#75af00">Mode</span><span style="color:#111">().</span><span style="color:#75af00">IsRegular</span><span style="color:#111">()</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">nil</span>
        <span style="color:#111">}</span>

        <span style="color:#75af00">targets</span> <span style="color:#111">=</span> <span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#75af00">targets</span><span style="color:#111">,</span><span style="color:#75af00">fpath</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">nil</span>
    <span style="color:#111">})</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">target</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">targets</span> <span style="color:#111">{</span>
        <span style="color:#75af00">f</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Open</span><span style="color:#111">(</span><span style="color:#75af00">target</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
            <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;bad target:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">target</span><span style="color:#111">,</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">err</span><span style="color:#111">)</span> <span style="color:#75715e">//prints error: too many open files
</span><span style="color:#75715e"></span>            <span style="color:#00a8c8">break</span>
        <span style="color:#111">}</span>
        <span style="color:#00a8c8">defer</span> <span style="color:#75af00">f</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span> <span style="color:#75715e">//will not be closed at the end of this code block
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//do something with the file...
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>One way to solve the problem is by wrapping the code block in a function.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;os&#34;</span>
    <span style="color:#d88200">&#34;path/filepath&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">if</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Args</span><span style="color:#111">)</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> <span style="color:#111">{</span>
        <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Exit</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#75af00">start</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Stat</span><span style="color:#111">(</span><span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Args</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">])</span>
    <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#f92672">||</span> <span style="color:#111">!</span><span style="color:#75af00">start</span><span style="color:#111">.</span><span style="color:#75af00">IsDir</span><span style="color:#111">(){</span>
        <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Exit</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">var</span> <span style="color:#75af00">targets</span> <span style="color:#111">[]</span><span style="color:#00a8c8">string</span>
    <span style="color:#75af00">filepath</span><span style="color:#111">.</span><span style="color:#75af00">Walk</span><span style="color:#111">(</span><span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Args</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">fpath</span> <span style="color:#00a8c8">string</span><span style="color:#111">,</span> <span style="color:#75af00">fi</span> <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">FileInfo</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#00a8c8">error</span><span style="color:#111">)</span> <span style="color:#00a8c8">error</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">return</span> <span style="color:#75af00">err</span>
        <span style="color:#111">}</span>

        <span style="color:#00a8c8">if</span> <span style="color:#111">!</span><span style="color:#75af00">fi</span><span style="color:#111">.</span><span style="color:#75af00">Mode</span><span style="color:#111">().</span><span style="color:#75af00">IsRegular</span><span style="color:#111">()</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">nil</span>
        <span style="color:#111">}</span>

        <span style="color:#75af00">targets</span> <span style="color:#111">=</span> <span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#75af00">targets</span><span style="color:#111">,</span><span style="color:#75af00">fpath</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">nil</span>
    <span style="color:#111">})</span>

    <span style="color:#00a8c8">for</span> <span style="color:#75af00">_</span><span style="color:#111">,</span><span style="color:#75af00">target</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">range</span> <span style="color:#75af00">targets</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">func</span><span style="color:#111">()</span> <span style="color:#111">{</span>
            <span style="color:#75af00">f</span><span style="color:#111">,</span> <span style="color:#75af00">err</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">os</span><span style="color:#111">.</span><span style="color:#75af00">Open</span><span style="color:#111">(</span><span style="color:#75af00">target</span><span style="color:#111">)</span>
            <span style="color:#00a8c8">if</span> <span style="color:#75af00">err</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
                <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;bad target:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">target</span><span style="color:#111">,</span><span style="color:#d88200">&#34;error:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">err</span><span style="color:#111">)</span>
                <span style="color:#00a8c8">return</span>
            <span style="color:#111">}</span>
            <span style="color:#00a8c8">defer</span> <span style="color:#75af00">f</span><span style="color:#111">.</span><span style="color:#75af00">Close</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//do something with the file...
</span><span style="color:#75715e"></span>        <span style="color:#111">}()</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Another option is to get rid of the <code>defer</code> statement :-)</p>
<h2 id="failed-type-assertions">Failed Type Assertions</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Failed type assertions return the &ldquo;zero value&rdquo; for the target type used in the assertion statement. This can lead to unexpected behavior when it&rsquo;s mixed with variable shadowing.</p>
<p>Incorrect:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;great&#34;</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">data</span><span style="color:#111">,</span> <span style="color:#75af00">ok</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">.(</span><span style="color:#00a8c8">int</span><span style="color:#111">);</span> <span style="color:#75af00">ok</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[is an int] value =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span>
    <span style="color:#111">}</span> <span style="color:#00a8c8">else</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[not an int] value =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span> 
        <span style="color:#75715e">//prints: [not an int] value =&gt; 0 (not &#34;great&#34;)
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;great&#34;</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">res</span><span style="color:#111">,</span> <span style="color:#75af00">ok</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">.(</span><span style="color:#00a8c8">int</span><span style="color:#111">);</span> <span style="color:#75af00">ok</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[is an int] value =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#75af00">res</span><span style="color:#111">)</span>
    <span style="color:#111">}</span> <span style="color:#00a8c8">else</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;[not an int] value =&gt;&#34;</span><span style="color:#111">,</span><span style="color:#75af00">data</span><span style="color:#111">)</span> 
        <span style="color:#75715e">//prints: [not an int] value =&gt; great (as expected)
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="blocked-goroutines-and-resource-leaks">Blocked Goroutines and Resource Leaks</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>Rob Pike talked about a number of fundamental concurrency patterns in his <a href="https://talks.golang.org/2012/concurrency.slide#1">&ldquo;Go Concurrency Patterns&rdquo;</a> presentation at Google I/O in 2012. Fetching the first result from a number of targets is one of them.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">func First(query string, replicas ...Search) Result {  
    c := make(chan Result)
    searchReplica := func(i int) { c &lt;- replicas[i](query) }
    for i := range replicas {
        go searchReplica(i)
    }
    return &lt;-c
}
</code></pre></td></tr></table>
</div>
</div><p>The function starts a goroutines for each search replica. Each goroutine sends its search result to the result channel. The first value from the result channel is returned.</p>
<p>What about the results from the other goroutines? What about the goroutines themselves?</p>
<p>The result channel in the <code>First()</code> function is unbuffered. This means that only the first goroutine returns. All other goroutines are stuck trying to send their results. This means if you have more than one replica each call will leak resources.</p>
<p>To avoid the leaks you need to make sure all goroutines exit. One potential solution is to use a buffered result channel big enough to hold all results.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">func First(query string, replicas ...Search) Result {  
    c := make(chan Result,len(replicas))
    searchReplica := func(i int) { c &lt;- replicas[i](query) }
    for i := range replicas {
        go searchReplica(i)
    }
    return &lt;-c
}
</code></pre></td></tr></table>
</div>
</div><p>Another potential solution is to use a <code>select</code> statement with a <code>default</code> case and a buffered result channel that can hold one value. The <code>default</code> case ensures that the goroutines don&rsquo;t get stuck even when the result channel can&rsquo;t receive messages.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">func First(query string, replicas ...Search) Result {  
    c := make(chan Result,1)
    searchReplica := func(i int) { 
        select {
        case c &lt;- replicas[i](query):
        default:
        }
    }
    for i := range replicas {
        go searchReplica(i)
    }
    return &lt;-c
}
</code></pre></td></tr></table>
</div>
</div><p>You can also use a special cancellation channel to interrupt the workers.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">func First(query string, replicas ...Search) Result {  
    c := make(chan Result)
    done := make(chan struct{})
    defer close(done)
    searchReplica := func(i int) { 
        select {
        case c &lt;- replicas[i](query):
        case &lt;- done:
        }
    }
    for i := range replicas {
        go searchReplica(i)
    }

    return &lt;-c
}
</code></pre></td></tr></table>
</div>
</div><p>Why did the presentation contain these bugs? Rob Pike simply didn&rsquo;t want to comlicate the slides. It makes sense, but it can be a problem for new Go developers who would use the code as is without thinking that it might have problems.</p>
<h2 id="same-address-for-different-zero-sized-variables">Same Address for Different Zero-sized Variables</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>If you have two different variables shouldn&rsquo;t they have different addresses? Well, it&rsquo;s not the case with Go :-) If you have zero-sized variables they might share the exact same address in memory.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">a</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">data</span><span style="color:#111">{}</span>
  <span style="color:#75af00">b</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#75af00">data</span><span style="color:#111">{}</span>
  
  <span style="color:#00a8c8">if</span> <span style="color:#75af00">a</span> <span style="color:#f92672">==</span> <span style="color:#75af00">b</span> <span style="color:#111">{</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;same address - a=%p b=%p\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">a</span><span style="color:#111">,</span><span style="color:#75af00">b</span><span style="color:#111">)</span>
    <span style="color:#75715e">//prints: same address - a=0x1953e4 b=0x1953e4
</span><span style="color:#75715e"></span>  <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="the-first-use-of-iota-doesnt-always-start-with-zero">The First Use of iota Doesn&rsquo;t Always Start with Zero</h2>
<ul>
<li>level: intermediate</li>
</ul>
<p>It may seem like the <code>iota</code> identifyer is like an increment operator. You start a new constant declaration and the first time you use <code>iota</code> you get zero, the second time you use it you get one and so on. It&rsquo;s not always the case though.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;fmt&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">const</span> <span style="color:#111">(</span>
  <span style="color:#75af00">azero</span> <span style="color:#111">=</span> <span style="color:#00a8c8">iota</span>
  <span style="color:#75af00">aone</span>  <span style="color:#111">=</span> <span style="color:#00a8c8">iota</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">const</span> <span style="color:#111">(</span>
  <span style="color:#75af00">info</span>  <span style="color:#111">=</span> <span style="color:#d88200">&#34;processing&#34;</span>
  <span style="color:#75af00">bzero</span> <span style="color:#111">=</span> <span style="color:#00a8c8">iota</span>
  <span style="color:#75af00">bone</span>  <span style="color:#111">=</span> <span style="color:#00a8c8">iota</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">azero</span><span style="color:#111">,</span><span style="color:#75af00">aone</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: 0 1
</span><span style="color:#75715e"></span>  <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">bzero</span><span style="color:#111">,</span><span style="color:#75af00">bone</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: 1 2
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>iota</code> is really an index operator for the current line in the constant declaration block, so if the first use of <code>iota</code> is not the first line in the constant declaration block the initial value will not be zero.</p>
<h2 id="using-pointer-receiver-methods-on-value-instances">Using Pointer Receiver Methods On Value Instances</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>It&rsquo;s OK to call a pointer receiver method on a value as long as the value is addressable. In other words, you don&rsquo;t need to have a value receiver version of the method in some cases.</p>
<p>Not every variable is addressable though. Map elements are not addressable. Variables referenced through interfaces are also not addressable.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#111">(</span><span style="color:#75af00">p</span> <span style="color:#f92672">*</span><span style="color:#75af00">data</span><span style="color:#111">)</span> <span style="color:#111">print</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;name:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">p</span><span style="color:#111">.</span><span style="color:#75af00">name</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">printer</span> <span style="color:#00a8c8">interface</span> <span style="color:#111">{</span>  
    <span style="color:#111">print</span><span style="color:#111">()</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">d1</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">data</span><span style="color:#111">{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">}</span>
    <span style="color:#75af00">d1</span><span style="color:#111">.</span><span style="color:#111">print</span><span style="color:#111">()</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">in</span> <span style="color:#75af00">printer</span> <span style="color:#111">=</span> <span style="color:#75af00">data</span><span style="color:#111">{</span><span style="color:#d88200">&#34;two&#34;</span><span style="color:#111">}</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span>    <span style="color:#75af00">in</span><span style="color:#111">.</span><span style="color:#111">print</span><span style="color:#111">()</span>

    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#75af00">data</span> <span style="color:#111">{</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">:</span><span style="color:#75af00">data</span><span style="color:#111">{</span><span style="color:#d88200">&#34;three&#34;</span><span style="color:#111">}}</span>
    <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">].</span><span style="color:#111">print</span><span style="color:#111">()</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Errors:</p>
<blockquote>
<p>/tmp/sandbox017696142/main.go:21: cannot use data literal (type data) as type printer in assignment: data does not implement printer (print method has pointer receiver)
/tmp/sandbox017696142/main.go:25: cannot call pointer method on m[&ldquo;x&rdquo;] /tmp/sandbox017696142/main.go:25: cannot take the address of m[&ldquo;x&rdquo;]</p>
</blockquote>
<h2 id="updating-map-value-fields">Updating Map Value Fields</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>If you have a map of struct values you can&rsquo;t update individual struct fields.</p>
<p>Fails:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#75af00">data</span> <span style="color:#111">{</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">:{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">}}</span>
    <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">].</span><span style="color:#75af00">name</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;two&#34;</span> <span style="color:#75715e">//error
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>/tmp/sandbox380452744/main.go:9: cannot assign to m[&ldquo;x&rdquo;].name</p>
</blockquote>
<p>It doesn&rsquo;t work because map elements are not addressable.</p>
<p>What can be extra confusing for new Go devs is the fact that slice elements are addressable.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">s</span> <span style="color:#f92672">:=</span> <span style="color:#111">[]</span><span style="color:#75af00">data</span> <span style="color:#111">{{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">}}</span>
    <span style="color:#75af00">s</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">].</span><span style="color:#75af00">name</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;two&#34;</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">s</span><span style="color:#111">)</span>    <span style="color:#75715e">//prints: [{two}]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that a while ago it was possible to update map element fields in one of the Go compilers (gccgo), but that behavior was quickly fixed :-) It was also considered as a potential feature for Go 1.3. It wasn&rsquo;t important enough to support at that point in time, so it&rsquo;s still on the todo list.</p>
<p>The first work around is to use a temporary variable.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#75af00">data</span> <span style="color:#111">{</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">:{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">}}</span>
    <span style="color:#75af00">r</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">]</span>
    <span style="color:#75af00">r</span><span style="color:#111">.</span><span style="color:#75af00">name</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;two&#34;</span>
    <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">]</span> <span style="color:#111">=</span> <span style="color:#75af00">r</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%v&#34;</span><span style="color:#111">,</span><span style="color:#75af00">m</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: map[x:{two}]
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Another workaround is to use a map of pointers.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#f92672">*</span><span style="color:#75af00">data</span> <span style="color:#111">{</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">:{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">}}</span>
    <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">].</span><span style="color:#75af00">name</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;two&#34;</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">])</span> <span style="color:#75715e">//prints: &amp;{two}
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>By the way, what happens when you run this code?</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#00a8c8">type</span> <span style="color:#75af00">data</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">name</span> <span style="color:#00a8c8">string</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">m</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">map</span><span style="color:#111">[</span><span style="color:#00a8c8">string</span><span style="color:#111">]</span><span style="color:#f92672">*</span><span style="color:#75af00">data</span> <span style="color:#111">{</span><span style="color:#d88200">&#34;x&#34;</span><span style="color:#111">:{</span><span style="color:#d88200">&#34;one&#34;</span><span style="color:#111">}}</span>
    <span style="color:#75af00">m</span><span style="color:#111">[</span><span style="color:#d88200">&#34;z&#34;</span><span style="color:#111">].</span><span style="color:#75af00">name</span> <span style="color:#111">=</span> <span style="color:#d88200">&#34;what?&#34;</span> <span style="color:#75715e">//???
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="nil-interfaces-and-nil-interfaces-values">&ldquo;nil&rdquo; Interfaces and &ldquo;nil&rdquo; Interfaces Values</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>This is the second most common gotcha in Go because interfaces are not pointers even though they may look like pointers. Interface variables will be &ldquo;nil&rdquo; only when their type and value fields are &ldquo;nil&rdquo;.</p>
<p>The interface type and value fields are populated based on the type and value of the variable used to create the corresponding interface variable. This can lead to unexpected behavior when you are trying to check if an interface variable equals to &ldquo;nil&rdquo;.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">data</span> <span style="color:#f92672">*</span><span style="color:#00a8c8">byte</span>
    <span style="color:#00a8c8">var</span> <span style="color:#75af00">in</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span>

    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">data</span><span style="color:#111">,</span><span style="color:#75af00">data</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">nil</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: &lt;nil&gt; true
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">in</span><span style="color:#111">,</span><span style="color:#75af00">in</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">nil</span><span style="color:#111">)</span>     <span style="color:#75715e">//prints: &lt;nil&gt; true
</span><span style="color:#75715e"></span>
    <span style="color:#75af00">in</span> <span style="color:#111">=</span> <span style="color:#75af00">data</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">in</span><span style="color:#111">,</span><span style="color:#75af00">in</span> <span style="color:#f92672">==</span> <span style="color:#00a8c8">nil</span><span style="color:#111">)</span>     <span style="color:#75715e">//prints: &lt;nil&gt; false
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//&#39;data&#39; is &#39;nil&#39;, but &#39;in&#39; is not &#39;nil&#39;
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Watch out for this trap when you have a function that returns interfaces.</p>
<p>Incorrect:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">doit</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">arg</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#f92672">*</span><span style="color:#00a8c8">struct</span><span style="color:#111">{}</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>

        <span style="color:#00a8c8">if</span><span style="color:#111">(</span><span style="color:#75af00">arg</span> <span style="color:#111">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#75af00">result</span> <span style="color:#111">=</span> <span style="color:#f92672">&amp;</span><span style="color:#00a8c8">struct</span><span style="color:#111">{}{}</span>
        <span style="color:#111">}</span>

        <span style="color:#00a8c8">return</span> <span style="color:#75af00">result</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">res</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">);</span> <span style="color:#75af00">res</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;good result:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">res</span><span style="color:#111">)</span> <span style="color:#75715e">//prints: good result: &lt;nil&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//&#39;res&#39; is not &#39;nil&#39;, but its value is &#39;nil&#39;
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Works:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">doit</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">func</span><span style="color:#111">(</span><span style="color:#75af00">arg</span> <span style="color:#00a8c8">int</span><span style="color:#111">)</span> <span style="color:#00a8c8">interface</span><span style="color:#111">{}</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">var</span> <span style="color:#75af00">result</span> <span style="color:#f92672">*</span><span style="color:#00a8c8">struct</span><span style="color:#111">{}</span> <span style="color:#111">=</span> <span style="color:#00a8c8">nil</span>

        <span style="color:#00a8c8">if</span><span style="color:#111">(</span><span style="color:#75af00">arg</span> <span style="color:#111">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#111">{</span>
            <span style="color:#75af00">result</span> <span style="color:#111">=</span> <span style="color:#f92672">&amp;</span><span style="color:#00a8c8">struct</span><span style="color:#111">{}{}</span>
        <span style="color:#111">}</span> <span style="color:#00a8c8">else</span> <span style="color:#111">{</span>
            <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">nil</span> <span style="color:#75715e">//return an explicit &#39;nil&#39;
</span><span style="color:#75715e"></span>        <span style="color:#111">}</span>

        <span style="color:#00a8c8">return</span> <span style="color:#75af00">result</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">if</span> <span style="color:#75af00">res</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">doit</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">);</span> <span style="color:#75af00">res</span> <span style="color:#f92672">!=</span> <span style="color:#00a8c8">nil</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;good result:&#34;</span><span style="color:#111">,</span><span style="color:#75af00">res</span><span style="color:#111">)</span>
    <span style="color:#111">}</span> <span style="color:#00a8c8">else</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;bad result (res is nil)&#34;</span><span style="color:#111">)</span> <span style="color:#75715e">//here as expected
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="stack-and-heap-variables">Stack and Heap Variables</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>You don&rsquo;t always know if your variable is allocated on the stack or heap. In C++ creating variables using the <code>new</code> operator always means that you have a heap variable. In Go the compiler decides where the variable will be allocated even if the <code>new()</code> or <code>make()</code> functions are used. The compiler picks the location to store the variable based on its size and the result of &ldquo;escape analysis&rdquo;. This also means that it&rsquo;s ok to return references to local variables, which is not ok in other languages like C or C++.</p>
<p>If you need to know where your variables are allocated pass the &ldquo;-m&rdquo; gc flag to &ldquo;go build&rdquo; or &ldquo;go run&rdquo; (e.g., <code>go run -gcflags -m app.go</code>).</p>
<h2 id="gomaxprocs-concurrency-and-parallelism">GOMAXPROCS, Concurrency, and Parallelism</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>Go 1.4 and below uses only one execution context / OS thread. This means that only one goroutine can execute at any given time. Starting with 1.5 Go sets the number of execution contexts to the number of logical CPU cores returned by <code>runtime.NumCPU()</code>. That number may or may not match the total number of logical CPU cores on your system depending on the CPU affinity settings of your process. You can adjust this number by changing the <code>GOMAXPROCS</code> environment variable or by calling the <code>runtime.GOMAXPROCS()</code> function.</p>
<p>There&rsquo;s a common misconception that <code>GOMAXPROCS</code> represents the number of CPUs Go will use to run goroutines. The <code>runtime.GOMAXPROCS()</code> function documentation adds more to the confusion. The <code>GOMAXPROCS</code> variable description (<a href="https://golang.org/pkg/runtime/">https://golang.org/pkg/runtime/</a>) does a better job talking about OS threads.</p>
<p>You can set <code>GOMAXPROCS</code> to more than the number of your CPUs. As of 1.10 there&rsquo;s no longer a limit for GOMAXPROCS. The max value for <code>GOMAXPROCS</code> used to be 256 and it was later increased to 1024 in 1.9.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;runtime&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">GOMAXPROCS</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: X (1 on play.golang.org)
</span><span style="color:#75715e"></span>    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">NumCPU</span><span style="color:#111">())</span>       <span style="color:#75715e">//prints: X (1 on play.golang.org)
</span><span style="color:#75715e"></span>    <span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">GOMAXPROCS</span><span style="color:#111">(</span><span style="color:#ae81ff">20</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">GOMAXPROCS</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: 20
</span><span style="color:#75715e"></span>    <span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">GOMAXPROCS</span><span style="color:#111">(</span><span style="color:#ae81ff">300</span><span style="color:#111">)</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">GOMAXPROCS</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">))</span> <span style="color:#75715e">//prints: 256
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="read-and-write-operation-reordering">Read and Write Operation Reordering</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>Go may reorder some operations, but it ensures that the overall behavior in the goroutine where it happens doesn&rsquo;t change. However, it doesn&rsquo;t guarantee the order of execution across multiple goroutines.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;runtime&#34;</span>
    <span style="color:#d88200">&#34;time&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">var</span> <span style="color:#75af00">_</span> <span style="color:#111">=</span> <span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">GOMAXPROCS</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">)</span>

<span style="color:#00a8c8">var</span> <span style="color:#75af00">a</span><span style="color:#111">,</span> <span style="color:#75af00">b</span> <span style="color:#00a8c8">int</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">u1</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">a</span> <span style="color:#111">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#75af00">b</span> <span style="color:#111">=</span> <span style="color:#ae81ff">2</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">u2</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">a</span> <span style="color:#111">=</span> <span style="color:#ae81ff">3</span>
    <span style="color:#75af00">b</span> <span style="color:#111">=</span> <span style="color:#ae81ff">4</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">p</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#111">println</span><span style="color:#111">(</span><span style="color:#75af00">a</span><span style="color:#111">)</span>
    <span style="color:#111">println</span><span style="color:#111">(</span><span style="color:#75af00">b</span><span style="color:#111">)</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#00a8c8">go</span> <span style="color:#75af00">u1</span><span style="color:#111">()</span>
    <span style="color:#00a8c8">go</span> <span style="color:#75af00">u2</span><span style="color:#111">()</span>
    <span style="color:#00a8c8">go</span> <span style="color:#75af00">p</span><span style="color:#111">()</span>
    <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Sleep</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#75af00">time</span><span style="color:#111">.</span><span style="color:#75af00">Second</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you run this code a few times you might see these <code>a</code> and <code>b</code> variable combinations:</p>
<blockquote>
<p>1
2</p>
<p>3
4</p>
<p>0
2</p>
<p>0
0</p>
<p>1
4</p>
</blockquote>
<p>The most interesting combination for <code>a</code> and <code>b</code> is &ldquo;02&rdquo;. It shows that <code>b</code> was updated before <code>a</code>.</p>
<p>If you need to preserve the order of read and write operations across multiple goroutines you&rsquo;ll need to use channels or the appropriate constructs from the &ldquo;sync&rdquo; package.</p>
<h2 id="preemptive-scheduling">Preemptive Scheduling</h2>
<ul>
<li>level: advanced</li>
</ul>
<p>It&rsquo;s possible to have a rogue goroutine that prevents other goroutines from running. It can happen if you have a <code>for</code> loop that doesn&rsquo;t allow the scheduler to run.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">done</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">false</span>

    <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(){</span>
        <span style="color:#75af00">done</span> <span style="color:#111">=</span> <span style="color:#00a8c8">true</span>
    <span style="color:#111">}()</span>

    <span style="color:#00a8c8">for</span> <span style="color:#111">!</span><span style="color:#75af00">done</span> <span style="color:#111">{</span>
    <span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;done!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The <code>for</code> loop doesn&rsquo;t have to be empty. It&rsquo;ll be a problem as long as it contains code that doesn&rsquo;t trigger the scheduler execution.</p>
<p>The scheduler will run after GC, &ldquo;go&rdquo; statements, blocking channel operations, blocking system calls, and lock operations. It may also run when a non-inlined function is called.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;fmt&#34;</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">done</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">false</span>

    <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(){</span>
        <span style="color:#75af00">done</span> <span style="color:#111">=</span> <span style="color:#00a8c8">true</span>
    <span style="color:#111">}()</span>

    <span style="color:#00a8c8">for</span> <span style="color:#111">!</span><span style="color:#75af00">done</span> <span style="color:#111">{</span>
        <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;not done!&#34;</span><span style="color:#111">)</span> <span style="color:#75715e">//not inlined
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;done!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>To find out if the function you call in the <code>for</code> loop is inlined pass the &ldquo;-m&rdquo; gc flag to &ldquo;go build&rdquo; or &ldquo;go run&rdquo; (e.g., <code>go build -gcflags -m</code>).</p>
<p>Another option is to invoke the scheduler explicitly. You can do it with the <code>Gosched()</code> function from the &ldquo;runtime&rdquo; package.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>  
    <span style="color:#d88200">&#34;fmt&#34;</span>
    <span style="color:#d88200">&#34;runtime&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>  
    <span style="color:#75af00">done</span> <span style="color:#f92672">:=</span> <span style="color:#00a8c8">false</span>

    <span style="color:#00a8c8">go</span> <span style="color:#00a8c8">func</span><span style="color:#111">(){</span>
        <span style="color:#75af00">done</span> <span style="color:#111">=</span> <span style="color:#00a8c8">true</span>
    <span style="color:#111">}()</span>

    <span style="color:#00a8c8">for</span> <span style="color:#111">!</span><span style="color:#75af00">done</span> <span style="color:#111">{</span>
        <span style="color:#75af00">runtime</span><span style="color:#111">.</span><span style="color:#75af00">Gosched</span><span style="color:#111">()</span>
    <span style="color:#111">}</span>
    <span style="color:#75af00">fmt</span><span style="color:#111">.</span><span style="color:#75af00">Println</span><span style="color:#111">(</span><span style="color:#d88200">&#34;done!&#34;</span><span style="color:#111">)</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that the code above contains a race condition. It was done intentionally to show the sheduling gotcha.</p>
<h2 id="import-c-and-multiline-import-blocks">Import C and Multiline Import Blocks</h2>
<ul>
<li>level: Cgo</li>
</ul>
<p>You need to import the &ldquo;C&rdquo; package to use Cgo. You can do that with a single line <code>import</code> or you can do it with an <code>import</code> block.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">#include &lt;stdlib.h&gt;
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;C&#34;</span>
<span style="color:#111">)</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;unsafe&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">cs</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">CString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;my go string&#34;</span><span style="color:#111">)</span>
  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">free</span><span style="color:#111">(</span><span style="color:#75af00">unsafe</span><span style="color:#111">.</span><span style="color:#75af00">Pointer</span><span style="color:#111">(</span><span style="color:#75af00">cs</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>If you are using the <code>import</code> block format you can&rsquo;t import other packages in the same block.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">#include &lt;stdlib.h&gt;
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;C&#34;</span>
  <span style="color:#d88200">&#34;unsafe&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">cs</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">CString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;my go string&#34;</span><span style="color:#111">)</span>
  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">free</span><span style="color:#111">(</span><span style="color:#75af00">unsafe</span><span style="color:#111">.</span><span style="color:#75af00">Pointer</span><span style="color:#111">(</span><span style="color:#75af00">cs</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>./main.go:13:2: could not determine kind of name for C.free</p>
</blockquote>
<h2 id="no-blank-lines-between-import-c-and-cgo-comments">No blank lines Between Import C and Cgo Comments</h2>
<ul>
<li>level: Cgo</li>
</ul>
<p>One of the first gotchas with Cgo is the location of the cgo comments above the <code>import &quot;C&quot;</code> statement.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">#include &lt;stdlib.h&gt;
</span><span style="color:#75715e">*/</span>

<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;C&#34;</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;unsafe&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">cs</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">CString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;my go string&#34;</span><span style="color:#111">)</span>
  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">free</span><span style="color:#111">(</span><span style="color:#75af00">unsafe</span><span style="color:#111">.</span><span style="color:#75af00">Pointer</span><span style="color:#111">(</span><span style="color:#75af00">cs</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>./main.go:15:2: could not determine kind of name for C.free</p>
</blockquote>
<p>Make sure you don&rsquo;t have any blank lines above <code>import &quot;C&quot;</code> statement.</p>
<h2 id="cant-call-c-functions-with-variable-arguments">Can&rsquo;t Call C Functions with Variable Arguments</h2>
<ul>
<li>level: Cgo</li>
</ul>
<p>You can&rsquo;t call C functions with variable arguments directly.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">#include &lt;stdio.h&gt;
</span><span style="color:#75715e">#include &lt;stdlib.h&gt;
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;C&#34;</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;unsafe&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">cstr</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">CString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;go&#34;</span><span style="color:#111">)</span>
  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%s\n&#34;</span><span style="color:#111">,</span><span style="color:#75af00">cstr</span><span style="color:#111">)</span> <span style="color:#75715e">//not ok
</span><span style="color:#75715e"></span>  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">free</span><span style="color:#111">(</span><span style="color:#75af00">unsafe</span><span style="color:#111">.</span><span style="color:#75af00">Pointer</span><span style="color:#111">(</span><span style="color:#75af00">cstr</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Compile Error:</p>
<blockquote>
<p>./main.go:15:2: unexpected type: &hellip;</p>
</blockquote>
<p>You have to wrap your variadic C functions in functions with a known number of parameters.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#75af00">main</span>

<span style="color:#75715e">/*
</span><span style="color:#75715e">#include &lt;stdio.h&gt;
</span><span style="color:#75715e">#include &lt;stdlib.h&gt;
</span><span style="color:#75715e">
</span><span style="color:#75715e">void out(char* in) {
</span><span style="color:#75715e">  printf(&#34;%s\n&#34;, in);
</span><span style="color:#75715e">}
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> <span style="color:#d88200">&#34;C&#34;</span>

<span style="color:#f92672">import</span> <span style="color:#111">(</span>
  <span style="color:#d88200">&#34;unsafe&#34;</span>
<span style="color:#111">)</span>

<span style="color:#00a8c8">func</span> <span style="color:#75af00">main</span><span style="color:#111">()</span> <span style="color:#111">{</span>
  <span style="color:#75af00">cstr</span> <span style="color:#f92672">:=</span> <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">CString</span><span style="color:#111">(</span><span style="color:#d88200">&#34;go&#34;</span><span style="color:#111">)</span>
  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">out</span><span style="color:#111">(</span><span style="color:#75af00">cstr</span><span style="color:#111">)</span> <span style="color:#75715e">//ok
</span><span style="color:#75715e"></span>  <span style="color:#75af00">C</span><span style="color:#111">.</span><span style="color:#75af00">free</span><span style="color:#111">(</span><span style="color:#75af00">unsafe</span><span style="color:#111">.</span><span style="color:#75af00">Pointer</span><span style="color:#111">(</span><span style="color:#75af00">cstr</span><span style="color:#111">))</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>翻译自<a href="http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/">50 Shades of Go: Traps, Gotchas, and Common Mistakes for New Golang Devs</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://coolshell.cn/articles/8460.html#%E5%85%B3%E4%BA%8E%E5%88%86%E5%8F%B7">陈浩：GO 语言简介（上）— 语法</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
</p>
</article>








<script src=""></script>


 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "fence-x" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1开头大括号不能放在单独的行上">1.开头大括号不能放在单独的行上</a></li>
        <li><a href="#2未使用的变量">2.未使用的变量</a></li>
        <li><a href="#3未使用的导入">3.未使用的导入</a></li>
        <li><a href="#4简短的变量声明只能在函数内部使用">4.简短的变量声明只能在函数内部使用</a></li>
        <li><a href="#5使用短变量声明重新声明变量">5.使用短变量声明重新声明变量</a></li>
        <li><a href="#6不能使用短变量声明来设置字段值">6.不能使用短变量声明来设置字段值</a></li>
        <li><a href="#7可能出现的变量阴影">7.可能出现的“变量阴影”</a></li>
        <li><a href="#8不能使用nil来初始化没有显式类型的变量-var">8.不能使用“nil”来初始化没有显式类型的变量 var</a></li>
        <li><a href="#9using-nil-slices-and-maps">9.Using &ldquo;nil&rdquo; Slices and Maps</a></li>
        <li><a href="#map-capacity">Map Capacity</a></li>
        <li><a href="#strings-cant-be-nil">Strings Can&rsquo;t Be &ldquo;nil&rdquo;</a></li>
        <li><a href="#array-function-arguments">Array Function Arguments</a></li>
        <li><a href="#unexpected-values-in-slice-and-array-range-clauses">Unexpected Values in Slice and Array &ldquo;range&rdquo; Clauses</a></li>
        <li><a href="#slices-and-arrays-are-one-dimensional">Slices and Arrays Are One-Dimensional</a></li>
        <li><a href="#accessing-non-existing-map-keys">Accessing Non-Existing Map Keys</a></li>
        <li><a href="#strings-are-immutable">Strings Are Immutable</a></li>
        <li><a href="#conversions-between-strings-and-byte-slices">Conversions Between Strings and Byte Slices</a></li>
        <li><a href="#strings-and-index-operator">Strings and Index Operator</a></li>
        <li><a href="#strings-are-not-always-utf8-text">Strings Are Not Always UTF8 Text</a></li>
        <li><a href="#string-length">String Length</a></li>
        <li><a href="#missing-comma-in-multi-line-slice-array-and-map-literals">Missing Comma In Multi-Line Slice, Array, and Map Literals</a></li>
        <li><a href="#logfatal-and-logpanic-do-more-than-log">log.Fatal and log.Panic Do More Than Log</a></li>
        <li><a href="#built-in-data-structure-operations-are-not-synchronized">Built-in Data Structure Operations Are Not Synchronized</a></li>
        <li><a href="#iteration-values-for-strings-in-range-clauses">Iteration Values For Strings in &ldquo;range&rdquo; Clauses</a></li>
        <li><a href="#iterating-through-a-map-using-a-for-range-clause">Iterating Through a Map Using a &ldquo;for range&rdquo; Clause</a></li>
        <li><a href="#fallthrough-behavior-in-switch-statements">Fallthrough Behavior in &ldquo;switch&rdquo; Statements</a></li>
        <li><a href="#increments-and-decrements">Increments and Decrements</a></li>
        <li><a href="#bitwise-not-operator">Bitwise NOT Operator</a></li>
        <li><a href="#operator-precedence-differences">Operator Precedence Differences</a></li>
        <li><a href="#unexported-structure-fields-are-not-encoded">Unexported Structure Fields Are Not Encoded</a></li>
        <li><a href="#app-exits-with-active-goroutines">App Exits With Active Goroutines</a></li>
        <li><a href="#sending-to-an-unbuffered-channel-returns-as-soon-as-the-target-receiver-is-ready">Sending to an Unbuffered Channel Returns As Soon As the Target Receiver Is Ready</a></li>
        <li><a href="#sending-to-an-closed-channel-causes-a-panic">Sending to an Closed Channel Causes a Panic</a></li>
        <li><a href="#using-nil-channels">Using &ldquo;nil&rdquo; Channels</a></li>
        <li><a href="#methods-with-value-receivers-cant-change-the-original-value">Methods with Value Receivers Can&rsquo;t Change the Original Value</a></li>
        <li><a href="#closing-http-response-body">Closing HTTP Response Body</a></li>
        <li><a href="#closing-http-connections">Closing HTTP Connections</a></li>
        <li><a href="#json-encoder-adds-a-newline-character">JSON Encoder Adds a Newline Character</a></li>
        <li><a href="#json-package-escapes-special-html-characters-in-keys-and-string-values">JSON Package Escapes Special HTML Characters in Keys and String Values</a></li>
        <li><a href="#unmarshalling-json-numbers-into-interface-values">Unmarshalling JSON Numbers into Interface Values</a></li>
        <li><a href="#json-string-values-will-not-be-ok-with-hex-or-other-non-utf8-escape-sequences">JSON String Values Will Not Be Ok with Hex or Other non-UTF8 Escape Sequences</a></li>
        <li><a href="#comparing-structs-arrays-slices-and-maps">Comparing Structs, Arrays, Slices, and Maps</a></li>
        <li><a href="#recovering-from-a-panic">Recovering From a Panic</a></li>
        <li><a href="#updating-and-referencing-item-values-in-slice-array-and-map-range-clauses">Updating and Referencing Item Values in Slice, Array, and Map &ldquo;range&rdquo; Clauses</a></li>
        <li><a href="#hidden-data-in-slices">&ldquo;Hidden&rdquo; Data in Slices</a></li>
        <li><a href="#slice-data-corruption">Slice Data &ldquo;Corruption&rdquo;</a></li>
        <li><a href="#stale-slices">&ldquo;Stale&rdquo; Slices</a></li>
        <li><a href="#type-declarations-and-methods">Type Declarations and Methods</a></li>
        <li><a href="#breaking-out-of-for-switch-and-for-select-code-blocks">Breaking Out of &ldquo;for switch&rdquo; and &ldquo;for select&rdquo; Code Blocks</a></li>
        <li><a href="#iteration-variables-and-closures-in-for-statements">Iteration Variables and Closures in &ldquo;for&rdquo; Statements</a></li>
        <li><a href="#deferred-function-call-argument-evaluation">Deferred Function Call Argument Evaluation</a></li>
        <li><a href="#deferred-function-call-execution">Deferred Function Call Execution</a></li>
        <li><a href="#failed-type-assertions">Failed Type Assertions</a></li>
        <li><a href="#blocked-goroutines-and-resource-leaks">Blocked Goroutines and Resource Leaks</a></li>
        <li><a href="#same-address-for-different-zero-sized-variables">Same Address for Different Zero-sized Variables</a></li>
        <li><a href="#the-first-use-of-iota-doesnt-always-start-with-zero">The First Use of iota Doesn&rsquo;t Always Start with Zero</a></li>
        <li><a href="#using-pointer-receiver-methods-on-value-instances">Using Pointer Receiver Methods On Value Instances</a></li>
        <li><a href="#updating-map-value-fields">Updating Map Value Fields</a></li>
        <li><a href="#nil-interfaces-and-nil-interfaces-values">&ldquo;nil&rdquo; Interfaces and &ldquo;nil&rdquo; Interfaces Values</a></li>
        <li><a href="#stack-and-heap-variables">Stack and Heap Variables</a></li>
        <li><a href="#gomaxprocs-concurrency-and-parallelism">GOMAXPROCS, Concurrency, and Parallelism</a></li>
        <li><a href="#read-and-write-operation-reordering">Read and Write Operation Reordering</a></li>
        <li><a href="#preemptive-scheduling">Preemptive Scheduling</a></li>
        <li><a href="#import-c-and-multiline-import-blocks">Import C and Multiline Import Blocks</a></li>
        <li><a href="#no-blank-lines-between-import-c-and-cgo-comments">No blank lines Between Import C and Cgo Comments</a></li>
        <li><a href="#cant-call-c-functions-with-variable-arguments">Can&rsquo;t Call C Functions with Variable Arguments</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  

  <script src="/js/audiojs/audio.min.js"></script>
  <script src="/js/audiojs/custom.js"></script>
</body>

</html>












